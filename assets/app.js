!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=9)}([function(t,e,n){"use strict";n.r(e);var r=function(t){return t},o=function(t){if(null==t)return r;var e,n,o=t.scale[0],a=t.scale[1],i=t.translate[0],s=t.translate[1];return function(t,r){r||(e=n=0);var c=2,l=t.length,u=new Array(l);for(u[0]=(e+=t[0])*o+i,u[1]=(n+=t[1])*a+s;c<l;)u[c]=t[c],++c;return u}},a=function(t){var e,n=o(t.transform),r=1/0,a=r,i=-r,s=-r;function c(t){(t=n(t))[0]<r&&(r=t[0]),t[0]>i&&(i=t[0]),t[1]<a&&(a=t[1]),t[1]>s&&(s=t[1])}function l(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(l);break;case"Point":c(t.coordinates);break;case"MultiPoint":t.coordinates.forEach(c)}}for(e in t.arcs.forEach(function(t){for(var e,o=-1,c=t.length;++o<c;)(e=n(t[o],o))[0]<r&&(r=e[0]),e[0]>i&&(i=e[0]),e[1]<a&&(a=e[1]),e[1]>s&&(s=e[1])}),t.objects)l(t.objects[e]);return[r,a,i,s]},i=function(t,e){for(var n,r=t.length,o=r-e;o<--r;)n=t[o],t[o++]=t[r],t[r]=n},s=function(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return c(t,e)})}:c(t,e)};function c(t,e){var n=e.id,r=e.bbox,o=null==e.properties?{}:e.properties,a=l(t,e);return null==n&&null==r?{type:"Feature",properties:o,geometry:a}:null==r?{type:"Feature",id:n,properties:o,geometry:a}:{type:"Feature",id:n,bbox:r,properties:o,geometry:a}}function l(t,e){var n=o(t.transform),r=t.arcs;function a(t,e){e.length&&e.pop();for(var o=r[t<0?~t:t],a=0,s=o.length;a<s;++a)e.push(n(o[a],a));t<0&&i(e,s)}function s(t){return n(t)}function c(t){for(var e=[],n=0,r=t.length;n<r;++n)a(t[n],e);return e.length<2&&e.push(e[0]),e}function l(t){for(var e=c(t);e.length<4;)e.push(e[0]);return e}function u(t){return t.map(l)}return function t(e){var n,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(t)};case"Point":n=s(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(s);break;case"LineString":n=c(e.arcs);break;case"MultiLineString":n=e.arcs.map(c);break;case"Polygon":n=u(e.arcs);break;case"MultiPolygon":n=e.arcs.map(u);break;default:return null}return{type:r,coordinates:n}}(e)}var u=function(t,e){var n={},r={},o={},a=[],i=-1;function s(t,e){for(var r in t){var o=t[r];delete e[o.start],delete o.start,delete o.end,o.forEach(function(t){n[t<0?~t:t]=1}),a.push(o)}}return e.forEach(function(n,r){var o,a=t.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(o=e[++i],e[i]=n,e[r]=o)}),e.forEach(function(e){var n,a,i=function(e){var n,r=t.arcs[e<0?~e:e],o=r[0];t.transform?(n=[0,0],r.forEach(function(t){n[0]+=t[0],n[1]+=t[1]})):n=r[r.length-1];return e<0?[n,o]:[o,n]}(e),s=i[0],c=i[1];if(n=o[s])if(delete o[n.end],n.push(e),n.end=c,a=r[c]){delete r[a.start];var l=a===n?n:n.concat(a);r[l.start=n.start]=o[l.end=a.end]=l}else r[n.start]=o[n.end]=n;else if(n=r[c])if(delete r[n.start],n.unshift(e),n.start=s,a=o[s]){delete o[a.end];var u=a===n?n:a.concat(n);r[u.start=a.start]=o[u.end=n.end]=u}else r[n.start]=o[n.end]=n;else r[(n=[e]).start=s]=o[n.end=c]=n}),s(o,r),s(r,o),e.forEach(function(t){n[t<0?~t:t]||a.push([t])}),a},f=function(t){return l(t,p.apply(this,arguments))};function p(t,e,n){var r,o,a;if(arguments.length>1)r=function(t,e,n){var r,o=[],a=[];function i(t){var e=t<0?~t:t;(a[e]||(a[e]=[])).push({i:t,g:r})}function s(t){t.forEach(i)}function c(t){t.forEach(s)}return function t(e){switch(r=e,e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"LineString":s(e.arcs);break;case"MultiLineString":case"Polygon":c(e.arcs);break;case"MultiPolygon":e.arcs.forEach(c)}}(e),a.forEach(null==n?function(t){o.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&o.push(t[0].i)}),o}(0,e,n);else for(o=0,r=new Array(a=t.arcs.length);o<a;++o)r[o]=o;return{type:"MultiLineString",arcs:u(t,r)}}var d=function(t){return l(t,h.apply(this,arguments))};function h(t,e){var n={},r=[],o=[];function a(t){t.forEach(function(e){e.forEach(function(e){(n[e=e<0?~e:e]||(n[e]=[])).push(t)})}),r.push(t)}function i(e){return function(t){for(var e,n=-1,r=t.length,o=t[r-1],a=0;++n<r;)e=o,o=t[n],a+=e[0]*o[1]-e[1]*o[0];return Math.abs(a)}(l(t,{type:"Polygon",arcs:[e]}).coordinates[0])}return e.forEach(function t(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"Polygon":a(e.arcs);break;case"MultiPolygon":e.arcs.forEach(a)}}),r.forEach(function(t){if(!t._){var e=[],r=[t];for(t._=1,o.push(e);t=r.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){n[t<0?~t:t].forEach(function(t){t._||(t._=1,r.push(t))})})})}}),r.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:o.map(function(e){var r,o=[];if(e.forEach(function(t){t.forEach(function(t){t.forEach(function(t){n[t<0?~t:t].length<2&&o.push(t)})})}),(r=(o=u(t,o)).length)>1)for(var a,s,c=1,l=i(o[0]);c<r;++c)(a=i(o[c]))>l&&(s=o[0],o[0]=o[c],o[c]=s,l=a);return o})}}var m=function(t,e){for(var n=0,r=t.length;n<r;){var o=n+r>>>1;t[o]<e?n=o+1:r=o}return n},g=function(t){var e={},n=t.map(function(){return[]});function r(t,n){t.forEach(function(t){t<0&&(t=~t);var r=e[t];r?r.push(n):e[t]=[n]})}function o(t,e){t.forEach(function(t){r(t,e)})}var a={LineString:r,MultiLineString:o,Polygon:o,MultiPolygon:function(t,e){t.forEach(function(t){o(t,e)})}};for(var i in t.forEach(function t(e,n){"GeometryCollection"===e.type?e.geometries.forEach(function(e){t(e,n)}):e.type in a&&a[e.type](e.arcs,n)}),e)for(var s=e[i],c=s.length,l=0;l<c;++l)for(var u=l+1;u<c;++u){var f,p=s[l],d=s[u];(f=n[p])[i=m(f,d)]!==d&&f.splice(i,0,d),(f=n[d])[i=m(f,p)]!==p&&f.splice(i,0,p)}return n},y=function(t){if(null==t)return r;var e,n,o=t.scale[0],a=t.scale[1],i=t.translate[0],s=t.translate[1];return function(t,r){r||(e=n=0);var c=2,l=t.length,u=new Array(l),f=Math.round((t[0]-i)/o),p=Math.round((t[1]-s)/a);for(u[0]=f-e,e=f,u[1]=p-n,n=p;c<l;)u[c]=t[c],++c;return u}},v=function(t,e){if(t.transform)throw new Error("already quantized");if(e&&e.scale)c=t.bbox;else{if(!((n=Math.floor(e))>=2))throw new Error("n must be ≥2");var n,r=(c=t.bbox||a(t))[0],o=c[1],i=c[2],s=c[3];e={scale:[i-r?(i-r)/(n-1):1,s-o?(s-o)/(n-1):1],translate:[r,o]}}var c,l,u=y(e),f=t.objects,p={};function d(t){return u(t)}function h(t){var e;switch(t.type){case"GeometryCollection":e={type:"GeometryCollection",geometries:t.geometries.map(h)};break;case"Point":e={type:"Point",coordinates:d(t.coordinates)};break;case"MultiPoint":e={type:"MultiPoint",coordinates:t.coordinates.map(d)};break;default:return t}return null!=t.id&&(e.id=t.id),null!=t.bbox&&(e.bbox=t.bbox),null!=t.properties&&(e.properties=t.properties),e}for(l in f)p[l]=h(f[l]);return{type:"Topology",bbox:c,transform:e,objects:p,arcs:t.arcs.map(function(t){var e,n=0,r=1,o=t.length,a=new Array(o);for(a[0]=u(t[0],0);++n<o;)((e=u(t[n],n))[0]||e[1])&&(a[r++]=e);return 1===r&&(a[r++]=[0,0]),a.length=r,a})}},b=function(t,e,n,r,o,a){3===arguments.length&&(r=a=Array,o=null);for(var i=new r(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),s=new a(t),c=t-1,l=0;l<t;++l)i[l]=o;return{set:function(r,a){for(var l=e(r)&c,u=i[l],f=0;u!=o;){if(n(u,r))return s[l]=a;if(++f>=t)throw new Error("full hashmap");u=i[l=l+1&c]}return i[l]=r,s[l]=a,a},maybeSet:function(r,a){for(var l=e(r)&c,u=i[l],f=0;u!=o;){if(n(u,r))return s[l];if(++f>=t)throw new Error("full hashmap");u=i[l=l+1&c]}return i[l]=r,s[l]=a,a},get:function(r,a){for(var l=e(r)&c,u=i[l],f=0;u!=o;){if(n(u,r))return s[l];if(++f>=t)break;u=i[l=l+1&c]}return a},keys:function(){for(var t=[],e=0,n=i.length;e<n;++e){var r=i[e];r!=o&&t.push(r)}return t}}},P=function(t,e){return t[0]===e[0]&&t[1]===e[1]},w=new ArrayBuffer(16),x=new Float64Array(w),M=new Uint32Array(w),k=function(t){x[0]=t[0],x[1]=t[1];var e=M[0]^M[1];return 2147483647&(e=e<<5^e>>7^M[2]^M[3])},E=function(t){var e,n,r,o,a=t.coordinates,i=t.lines,s=t.rings,c=function(){for(var t=b(1.4*a.length,M,E,Int32Array,-1,Int32Array),e=new Int32Array(a.length),n=0,r=a.length;n<r;++n)e[n]=t.maybeSet(n,n);return e}(),l=new Int32Array(a.length),u=new Int32Array(a.length),f=new Int32Array(a.length),p=new Int8Array(a.length),d=0;for(e=0,n=a.length;e<n;++e)l[e]=u[e]=f[e]=-1;for(e=0,n=i.length;e<n;++e){var h=i[e],m=h[0],g=h[1];for(r=c[m],o=c[++m],++d,p[r]=1;++m<=g;)x(e,r,r=o,o=c[m]);++d,p[o]=1}for(e=0,n=a.length;e<n;++e)l[e]=-1;for(e=0,n=s.length;e<n;++e){var y=s[e],v=y[0]+1,w=y[1];for(x(e,c[w-1],r=c[v-1],o=c[v]);++v<=w;)x(e,r,r=o,o=c[v])}function x(t,e,n,r){if(l[n]!==t){l[n]=t;var o=u[n];if(o>=0){var a=f[n];o===e&&a===r||o===r&&a===e||(++d,p[n]=1)}else u[n]=e,f[n]=r}}function M(t){return k(a[t])}function E(t,e){return P(a[t],a[e])}l=u=f=null;var R,$=function(t,e,n,r,o){3===arguments.length&&(r=Array,o=null);for(var a=new r(t=1<<Math.max(4,Math.ceil(Math.log(t)/Math.LN2))),i=t-1,s=0;s<t;++s)a[s]=o;return{add:function(r){for(var s=e(r)&i,c=a[s],l=0;c!=o;){if(n(c,r))return!0;if(++l>=t)throw new Error("full hashset");c=a[s=s+1&i]}return a[s]=r,!0},has:function(r){for(var s=e(r)&i,c=a[s],l=0;c!=o;){if(n(c,r))return!0;if(++l>=t)break;c=a[s=s+1&i]}return!1},values:function(){for(var t=[],e=0,n=a.length;e<n;++e){var r=a[e];r!=o&&t.push(r)}return t}}}(1.4*d,k,P);for(e=0,n=a.length;e<n;++e)p[R=c[e]]&&$.add(a[R]);return $};function R(t,e,n){for(var r,o=e+(n---e>>1);e<o;++e,--n)r=t[e],t[e]=t[n],t[n]=r}function $(t){var e,n=J(t.geometry);for(e in null!=t.id&&(n.id=t.id),null!=t.bbox&&(n.bbox=t.bbox),t.properties){n.properties=t.properties;break}return n}function J(t){if(null==t)return{type:null};var e="GeometryCollection"===t.type?{type:"GeometryCollection",geometries:t.geometries.map(J)}:"Point"===t.type||"MultiPoint"===t.type?{type:t.type,coordinates:t.coordinates}:{type:t.type,arcs:t.coordinates};return null!=t.bbox&&(e.bbox=t.bbox),e}var A=function(t,e){var n=function(t){var e=1/0,n=1/0,r=-1/0,o=-1/0;function a(t){null!=t&&i.hasOwnProperty(t.type)&&i[t.type](t)}var i={GeometryCollection:function(t){t.geometries.forEach(a)},Point:function(t){s(t.coordinates)},MultiPoint:function(t){t.coordinates.forEach(s)},LineString:function(t){c(t.arcs)},MultiLineString:function(t){t.arcs.forEach(c)},Polygon:function(t){t.arcs.forEach(c)},MultiPolygon:function(t){t.arcs.forEach(l)}};function s(t){var a=t[0],i=t[1];a<e&&(e=a),a>r&&(r=a),i<n&&(n=i),i>o&&(o=i)}function c(t){t.forEach(s)}function l(t){t.forEach(c)}for(var u in t)a(t[u]);return r>=e&&o>=n?[e,n,r,o]:void 0}(t=function(t){var e,n,r={};for(e in t)r[e]=null==(n=t[e])?{type:null}:("FeatureCollection"===n.type?function(t){var e={type:"GeometryCollection",geometries:t.features.map($)};return null!=t.bbox&&(e.bbox=t.bbox),e}:"Feature"===n.type?$:J)(n);return r}(t)),r=e>0&&n&&function(t,e,n){var r=e[0],o=e[1],a=e[2],i=e[3],s=a-r?(n-1)/(a-r):1,c=i-o?(n-1)/(i-o):1;function l(t){return[Math.round((t[0]-r)*s),Math.round((t[1]-o)*c)]}function u(t,e){for(var n,a,i,l,u,f=-1,p=0,d=t.length,h=new Array(d);++f<d;)n=t[f],l=Math.round((n[0]-r)*s),u=Math.round((n[1]-o)*c),l===a&&u===i||(h[p++]=[a=l,i=u]);for(h.length=p;p<e;)p=h.push([h[0][0],h[0][1]]);return h}function f(t){return u(t,2)}function p(t){return u(t,4)}function d(t){return t.map(p)}function h(t){null!=t&&m.hasOwnProperty(t.type)&&m[t.type](t)}var m={GeometryCollection:function(t){t.geometries.forEach(h)},Point:function(t){t.coordinates=l(t.coordinates)},MultiPoint:function(t){t.coordinates=t.coordinates.map(l)},LineString:function(t){t.arcs=f(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(f)},Polygon:function(t){t.arcs=d(t.arcs)},MultiPolygon:function(t){t.arcs=t.arcs.map(d)}};for(var g in t)h(t[g]);return{scale:[1/s,1/c],translate:[r,o]}}(t,n,e),o=function(t){var e,n,r,o,a=t.coordinates,i=t.lines,s=t.rings,c=i.length+s.length;for(delete t.lines,delete t.rings,r=0,o=i.length;r<o;++r)for(e=i[r];e=e.next;)++c;for(r=0,o=s.length;r<o;++r)for(n=s[r];n=n.next;)++c;var l=b(2*c*1.4,k,P),u=t.arcs=[];for(r=0,o=i.length;r<o;++r){e=i[r];do{f(e)}while(e=e.next)}for(r=0,o=s.length;r<o;++r)if((n=s[r]).next)do{f(n)}while(n=n.next);else p(n);function f(t){var e,n,r,o,i,s,c,f;if(r=l.get(e=a[t[0]]))for(c=0,f=r.length;c<f;++c)if(d(o=r[c],t))return t[0]=o[0],void(t[1]=o[1]);if(i=l.get(n=a[t[1]]))for(c=0,f=i.length;c<f;++c)if(h(s=i[c],t))return t[1]=s[0],void(t[0]=s[1]);r?r.push(t):l.set(e,[t]),i?i.push(t):l.set(n,[t]),u.push(t)}function p(t){var e,n,r,o,i;if(n=l.get(a[t[0]]))for(o=0,i=n.length;o<i;++o){if(m(r=n[o],t))return t[0]=r[0],void(t[1]=r[1]);if(g(r,t))return t[0]=r[1],void(t[1]=r[0])}if(n=l.get(e=a[t[0]+y(t)]))for(o=0,i=n.length;o<i;++o){if(m(r=n[o],t))return t[0]=r[0],void(t[1]=r[1]);if(g(r,t))return t[0]=r[1],void(t[1]=r[0])}n?n.push(t):l.set(e,[t]),u.push(t)}function d(t,e){var n=t[0],r=e[0],o=t[1];if(n-o!=r-e[1])return!1;for(;n<=o;++n,++r)if(!P(a[n],a[r]))return!1;return!0}function h(t,e){var n=t[0],r=e[0],o=t[1],i=e[1];if(n-o!=r-i)return!1;for(;n<=o;++n,--i)if(!P(a[n],a[i]))return!1;return!0}function m(t,e){var n=t[0],r=e[0],o=t[1]-n;if(o!==e[1]-r)return!1;for(var i=y(t),s=y(e),c=0;c<o;++c)if(!P(a[n+(c+i)%o],a[r+(c+s)%o]))return!1;return!0}function g(t,e){var n=t[0],r=e[0],o=t[1],i=e[1],s=o-n;if(s!==i-r)return!1;for(var c=y(t),l=s-y(e),u=0;u<s;++u)if(!P(a[n+(u+c)%s],a[i-(u+l)%s]))return!1;return!0}function y(t){for(var e=t[0],n=t[1],r=e,o=r,i=a[r];++r<n;){var s=a[r];(s[0]<i[0]||s[0]===i[0]&&s[1]<i[1])&&(o=r,i=s)}return o-e}return t}(function(t){var e,n,r,o=E(t),a=t.coordinates,i=t.lines,s=t.rings;for(n=0,r=i.length;n<r;++n)for(var c=i[n],l=c[0],u=c[1];++l<u;)o.has(a[l])&&(e={0:l,1:c[1]},c[1]=l,c=c.next=e);for(n=0,r=s.length;n<r;++n)for(var f=s[n],p=f[0],d=p,h=f[1],m=o.has(a[p]);++d<h;)o.has(a[d])&&(m?(e={0:d,1:f[1]},f[1]=d,f=f.next=e):(g=a,y=p,v=h,b=h-d,R(g,y,v),R(g,y,y+b),R(g,y+b,v),a[h]=a[p],m=!0,d=p));var g,y,v,b;return t}(function(t){var e=-1,n=[],r=[],o=[];function a(t){t&&i.hasOwnProperty(t.type)&&i[t.type](t)}var i={GeometryCollection:function(t){t.geometries.forEach(a)},LineString:function(t){t.arcs=s(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(s)},Polygon:function(t){t.arcs=t.arcs.map(c)},MultiPolygon:function(t){t.arcs=t.arcs.map(l)}};function s(t){for(var r=0,a=t.length;r<a;++r)o[++e]=t[r];var i={0:e-a+1,1:e};return n.push(i),i}function c(t){for(var n=0,a=t.length;n<a;++n)o[++e]=t[n];var i={0:e-a+1,1:e};return r.push(i),i}function l(t){return t.map(c)}for(var u in t)a(t[u]);return{type:"Topology",coordinates:o,lines:n,rings:r,objects:t}}(t))),a=o.coordinates,i=b(1.4*o.arcs.length,S,j);function s(t){t&&c.hasOwnProperty(t.type)&&c[t.type](t)}t=o.objects,o.bbox=n,o.arcs=o.arcs.map(function(t,e){return i.set(t,e),a.slice(t[0],t[1]+1)}),delete o.coordinates,a=null;var c={GeometryCollection:function(t){t.geometries.forEach(s)},LineString:function(t){t.arcs=l(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(l)},Polygon:function(t){t.arcs=t.arcs.map(l)},MultiPolygon:function(t){t.arcs=t.arcs.map(u)}};function l(t){var e=[];do{var n=i.get(t);e.push(t[0]<t[1]?n:~n)}while(t=t.next);return e}function u(t){return t.map(l)}for(var f in t)s(t[f]);return r&&(o.transform=r,o.arcs=function(t){for(var e=-1,n=t.length;++e<n;){for(var r,o,a=t[e],i=0,s=1,c=a.length,l=a[0],u=l[0],f=l[1];++i<c;)r=(l=a[i])[0],o=l[1],r===u&&o===f||(a[s++]=[r-u,o-f],u=r,f=o);1===s&&(a[s++]=[0,0]),a.length=s}return t}(o.arcs)),o};function S(t){var e,n=t[0],r=t[1];return r<n&&(e=n,n=r,r=e),n+31*r}function j(t,e){var n,r=t[0],o=t[1],a=e[0],i=e[1];return o<r&&(n=r,r=o,o=n),i<a&&(n=a,a=i,i=n),r===a&&o===i}var C=function(t,e){var n,r=t.objects,o={};function a(t){var e,n;switch(t.type){case"Polygon":e=(n=i(t.arcs))?{type:"Polygon",arcs:n}:{type:null};break;case"MultiPolygon":e=(n=t.arcs.map(i).filter(N)).length?{type:"MultiPolygon",arcs:n}:{type:null};break;case"GeometryCollection":e=(n=t.geometries.map(a).filter(O)).length?{type:"GeometryCollection",geometries:n}:{type:null};break;default:return t}return null!=t.id&&(e.id=t.id),null!=t.bbox&&(e.bbox=t.bbox),null!=t.properties&&(e.properties=t.properties),e}function i(t){return t.length&&(n=t[0],e(n,!1))?[t[0]].concat(t.slice(1).filter(s)):null;var n}function s(t){return e(t,!0)}for(n in null==e&&(e=L),r)o[n]=a(r[n]);return function(t){var e,n,r=t.objects,o={},a=t.arcs,i=a.length,s=-1,c=new Array(i),l=0,u=-1;function f(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(f);break;case"LineString":d(t.arcs);break;case"MultiLineString":case"Polygon":t.arcs.forEach(d);break;case"MultiPolygon":t.arcs.forEach(h)}}function p(t){t<0&&(t=~t),c[t]||(c[t]=1,++l)}function d(t){t.forEach(p)}function h(t){t.forEach(d)}function m(t){var e;switch(t.type){case"GeometryCollection":e={type:"GeometryCollection",geometries:t.geometries.map(m)};break;case"LineString":e={type:"LineString",arcs:y(t.arcs)};break;case"MultiLineString":e={type:"MultiLineString",arcs:t.arcs.map(y)};break;case"Polygon":e={type:"Polygon",arcs:t.arcs.map(y)};break;case"MultiPolygon":e={type:"MultiPolygon",arcs:t.arcs.map(v)};break;default:return t}return null!=t.id&&(e.id=t.id),null!=t.bbox&&(e.bbox=t.bbox),null!=t.properties&&(e.properties=t.properties),e}function g(t){return t<0?~c[~t]:c[t]}function y(t){return t.map(g)}function v(t){return t.map(y)}for(n in r)f(r[n]);for(e=new Array(l);++s<i;)c[s]&&(c[s]=++u,e[u]=a[s]);for(n in r)o[n]=m(r[n]);return{type:"Topology",bbox:t.bbox,transform:t.transform,objects:o,arcs:e}}({type:"Topology",bbox:t.bbox,transform:t.transform,objects:o,arcs:t.arcs})};function L(){return!0}function N(t){return t}function O(t){return null!=t.type}var I=function(t){var e,n=new Array(t.arcs.length),r=0;function o(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(o);break;case"Polygon":a(t.arcs);break;case"MultiPolygon":t.arcs.forEach(a)}}function a(t){for(var e=0,o=t.length;e<o;++e,++r)for(var a=t[e],i=0,s=a.length;i<s;++i){var c=a[i];c<0&&(c=~c);var l=n[c];null==l?n[c]=r:l!==r&&(n[c]=-1)}}for(e in t.objects)o(t.objects[e]);return function(t){for(var e,r=0,o=t.length;r<o;++r)if(-1===n[(e=t[r])<0?~e:e])return!0;return!1}};function T(t){var e=t[0],n=t[1],r=t[2];return Math.abs((e[0]-r[0])*(n[1]-e[1])-(e[0]-n[0])*(r[1]-e[1]))/2}function _(t){for(var e,n=-1,r=t.length,o=t[r-1],a=0;++n<r;)e=o,o=t[n],a+=e[0]*o[1]-e[1]*o[0];return Math.abs(a)/2}var F=function(t,e,n){return e=null==e?Number.MIN_VALUE:+e,null==n&&(n=_),function(r,o){return n(s(t,{type:"Polygon",arcs:[r]}).geometry.coordinates[0],o)>=e}},U=function(t,e,n){var r=I(t),o=F(t,e,n);return function(t,e){return r(t,e)||o(t,e)}};function G(t,e){return t[1][2]-e[1][2]}function D(t){return[t[0],t[1],0]}var H=function(t,e){var n=t.transform?o(t.transform):D,r=function(){var t={},e=[],n=0;function r(t,n){for(;n>0;){var r=(n+1>>1)-1,o=e[r];if(G(t,o)>=0)break;e[o._=n]=o,e[t._=n=r]=t}}function o(t,r){for(;;){var o=r+1<<1,a=o-1,i=r,s=e[i];if(a<n&&G(e[a],s)<0&&(s=e[i=a]),o<n&&G(e[o],s)<0&&(s=e[i=o]),i===r)break;e[s._=r]=s,e[t._=r=i]=t}}return t.push=function(t){return r(e[t._=n]=t,n++),n},t.pop=function(){if(!(n<=0)){var t,r=e[0];return--n>0&&(t=e[n],o(e[t._=0]=t,0)),r}},t.remove=function(t){var a,i=t._;if(e[i]===t)return i!==--n&&(G(a=e[n],t)<0?r:o)(e[a._=i]=a,i),i},t}();null==e&&(e=T);var a=t.arcs.map(function(t){var o,a,s,c=[],l=0;for(a=1,s=(t=t.map(n)).length-1;a<s;++a)(o=[t[a-1],t[a],t[a+1]])[1][2]=e(o),c.push(o),r.push(o);for(t[0][2]=t[s][2]=1/0,a=0,s=c.length;a<s;++a)(o=c[a]).previous=c[a-1],o.next=c[a+1];for(;o=r.pop();){var u=o.previous,f=o.next;o[1][2]<l?o[1][2]=l:l=o[1][2],u&&(u.next=f,u[2]=o[2],i(u)),f&&(f.previous=u,f[0]=o[0],i(f))}return t});function i(t){r.remove(t),t[1][2]=e(t),r.push(t)}return{type:"Topology",bbox:t.bbox,objects:t.objects,arcs:a}},q=function(t,e){var n=[];return t.arcs.forEach(function(t){t.forEach(function(t){isFinite(t[2])&&n.push(t[2])})}),n.length&&function(t,e){if(!(n=t.length))return;if((e=+e)<=0||n<2)return t[0];if(e>=1)return t[n-1];var n,r=(n-1)*e,o=Math.floor(r),a=t[o],i=t[o+1];return a+(i-a)*(r-o)}(n.sort(B),e)};function B(t,e){return e-t}var z=function(t,e){e=null==e?Number.MIN_VALUE:+e;var n=t.arcs.map(function(t){for(var n,r=-1,o=0,a=t.length,i=new Array(a);++r<a;)(n=t[r])[2]>=e&&(i[o++]=[n[0],n[1]]);return i.length=o,i});return{type:"Topology",transform:t.transform,bbox:t.bbox,objects:t.objects,arcs:n}},V=Math.PI,W=2*V,X=V/4,Y=V/180,Z=Math.abs,K=Math.atan2,Q=Math.cos,tt=Math.sin;function et(t,e){for(var n,r,o,a=0,i=t.length,s=0,c=t[e?a++:i-1],l=c[0]*Y,u=c[1]*Y/2+X,f=Q(u),p=tt(u);a<i;++a){n=l,l=(c=t[a])[0]*Y,u=c[1]*Y/2+X,r=f,f=Q(u),o=p,p=tt(u);var d=l-n,h=d>=0?1:-1,m=h*d,g=o*p,y=r*f+g*Q(m),v=g*h*tt(m);s+=K(v,y)}return s}function nt(t,e){var n=et(t,!0);return e&&(n*=-1),2*(n<0?W+n:n)}function rt(t){return 2*Z(et(t,!1))}n.d(e,"bbox",function(){return a}),n.d(e,"feature",function(){return s}),n.d(e,"mesh",function(){return f}),n.d(e,"meshArcs",function(){return p}),n.d(e,"merge",function(){return d}),n.d(e,"mergeArcs",function(){return h}),n.d(e,"neighbors",function(){return g}),n.d(e,"quantize",function(){return v}),n.d(e,"transform",function(){return o}),n.d(e,"untransform",function(){return y}),n.d(e,"topology",function(){return A}),n.d(e,"filter",function(){return C}),n.d(e,"filterAttached",function(){return I}),n.d(e,"filterAttachedWeight",function(){return U}),n.d(e,"filterWeight",function(){return F}),n.d(e,"planarRingArea",function(){return _}),n.d(e,"planarTriangleArea",function(){return T}),n.d(e,"presimplify",function(){return H}),n.d(e,"quantile",function(){return q}),n.d(e,"simplify",function(){return z}),n.d(e,"sphericalRingArea",function(){return nt}),n.d(e,"sphericalTriangleArea",function(){return rt})},function(t,e,n){"use strict";function r(t,e,n,r){const o=(n-t)*Math.PI/180,a=(r-e)*Math.PI/180,i=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2);return 6371e3*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}t.exports={calculateLength:function(t){if(t.length<2)return 0;let e=0;for(let n=1;n<t.length;n++)e+=r(t[n-1][1],t[n-1][0],t[n][1],t[n][0]);return e},distance:r}},function(t,e,n){"use strict";var r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=n(1);const a=o.calculateLength,i=o.distance,s=-1,c=0,l=1,u=2;function f(t,e){return Math.round(1e5*t[0])===Math.round(1e5*e[0])&&Math.round(1e5*t[1])===Math.round(1e5*e[1])}function p(t,e){for(let n=0;n<t.length;n++)for(let r=0;r<t[n].length-1;r++){const o=t[n][r],a=t[n][r+1],s=i(o[2],o[1],e[1],e[0]),c=i(e[1],e[0],a[2],a[1]),l=i(o[2],o[1],a[2],a[1]);if(Math.round(s+c)===Math.round(l))return[n,r,r+1]}return!1}function d(t,e,n,r,o=c,a=[]){log("----------------------------------------------------------");const i=[];n[0]===r[0]&&(log("found direct"),i.push([[n[0],n[1],r[1]]]));const f=a.slice();f.push(`${n[0]}/${n[1]}`);let p,h=Object.keys(e[n[0]]).map(t=>parseInt(t));for(h.sort((t,e)=>t-e),p=0;p<h.length&&!(h[p]>=n[1]);p++);log("start",n),log("points, idx",h,p);const m=h[p]===n[1];if(log("at intersection",m),m&&o!==u){log("intersection",n[0],n[1]);const o=e[n[0]][n[1]];if(null===o||f.includes(`${o[0]}/${o[1]}`))log("intersection dead end");else{log("find route for",o,r);const n=d(t,e,o,r,u,f);log("intersection routes",n);for(let t=0;t<n.length;t++)i.push([...n[t]]);log("current routes",i)}}if(log("prev direction",o),o!==l)if(log("left idx",p-1),0===p)log("left dead end");else{const o=[n[0],h[p-1]];log("left",o),log("find route for",o,r);const a=d(t,e,o,r,s,f);log("left routes",a);for(let t=0;t<a.length;t++)i.push([[n[0],n[1],o[1]],...a[t]]);log("current routes",i)}if(o!==s)if(log("right idx",p),m&&p===h.length-1)log("right dead end");else{const o=[n[0],h[m?p+1:p]];log("right",o),log("find route for",o,r);const a=d(t,e,o,r,l,f);log("right routes",a);for(let t=0;t<a.length;t++)i.push([[n[0],n[1],o[1]],...a[t]]);log("current routes",i)}return log("final routes",i),i}t.exports=function(t,e,n){return log("line",t[0].properties.lineName,t[0].properties.company),log("lines.length",t.length),log("start",e.properties.stationName),log("end",n.properties.stationName),function(t,e,n){log(e,n);const o=[],i=[],s={};for(let e=0;e<t.length;e++){const n=o.length,r=t[e].geometry.coordinates.slice().map((t,e)=>[e,...t]);o.push(r),i.push([n,r[0]]),i.push([n,r[r.length-1]]),s[e]={},s[e][0]=null,s[e][r.length-1]=null}log("lines",o),log("endpoints",i);for(let t=0;t<o.length;t++)for(let e=0;e<i.length;e++){const n=[i[e][1][1],i[e][1][2]],r=o[t].filter(([t,r,o])=>i[e][1][0]!==t&&f([r,o],n))[0];r&&(log(`${t}[${r[0]}] - ${i[e][0]}[${i[e][1][0]}]`),s[t][r[0]]=[i[e][0],i[e][1][0]],s[i[e][0]][i[e][1][0]]=[t,r[0]])}log("intersections",s);let c=[null,null,!1],l=[null,null,!1];for(let t=0;t<o.length;t++){for(let r=0;r<o[t].length;r++){const a=o[t][r];if(f(e.geometry.coordinates,[a[1],a[2]])?(c[0]=t,c[1]=r):f(n.geometry.coordinates,[a[1],a[2]])&&(l[0]=t,l[1]=r),null!==c[0]&&null!==l[0])break}if(null!==c[0]&&null!==l[0])break}if(null===c[0]){log("start over straight line");const t=p(o,e.geometry.coordinates);if(!1===t)return log("start is not over any line"),!1;c[0]=t[0],c[1]=t[1],c[2]=t[2]}if(null===l[0]){log("end over straight line");const t=p(o,n.geometry.coordinates);if(!1===t)return log("end is not over any line"),!1;l[0]=t[0],l[1]=t[1],l[2]=t[2]}log("start end",c,l);const u=d(o,s,c,l);if(!1!==c[2]&&u.push(...d(o,s,[c[0],c[2]],l)),!1!==l[2]&&u.push(...d(o,s,c,[l[0],l[2]])),!1!==c[2]&&!1!==l[2]&&u.push(...d(o,s,[c[0],c[2]],[l[0],l[2]])),0===u.length)return!1;for(let t=0;t<u.length;t++){const r=u[t];!1===c[2]||r[0][0]!==c[0]||r[0][1]!==c[1]&&r[0][1]!==c[2]||r.unshift(e.geometry.coordinates),!1===l[2]||r[0][0]!==l[0]||r[0][1]!==l[1]&&r[0][1]!==l[2]||r.unshift(n.geometry.coordinates);const o=r.length-1;!1===c[2]||r[o][0]!==c[0]||r[o][2]!==c[1]&&r[o][2]!==c[2]||r.push(e.geometry.coordinates),!1===l[2]||r[o][0]!==l[0]||r[o][2]!==l[1]&&r[o][2]!==l[2]||r.push(n.geometry.coordinates)}log("final route candidates",u);const h=u.map(t=>[].concat(...t.map(t=>{if(2===t.length)return[[null,t[0],t[1]]];var e=r(t,3);const n=e[0],a=e[1],i=e[2];return a<i?o[n].slice(a,i+1):o[n].slice(i,a+1).reverse()})).map(([t,e,n])=>[e,n]));if(1===h.length)return h[0];const m=h.map(t=>[t,a(t)]);return m.sort((t,e)=>t[1]-e[1]),m[0][0]}(t,e,n)}},function(t,e,n){"use strict";window.$=document.querySelector.bind(document),window.$$=document.querySelectorAll.bind(document),[HTMLDocument,HTMLElement].forEach(t=>{t.prototype.$=t.prototype.querySelector,t.prototype.$$=t.prototype.querySelectorAll}),HTMLElement.prototype.$show=function(t="block"){this.style.display=t},HTMLElement.prototype.$hide=function(){this.style.display="none"},window._make=((t,e={})=>{const n=document.createElement(t);return Object.keys(e).forEach(t=>{n.setAttribute(t,e[t])}),n}),window.log=((...t)=>{console.log("["+(new Date).toLocaleString()+"]",...t)})},function(t,e,n){"use strict";t.exports.VERSION_RAILROAD=1,t.exports.VERSION_STATION=3},function(t,e){(function(e){t.exports=e}).call(this,{})},function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},function(t,e,n){var r,o=o||function(t){"use strict";if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=function(){return t.URL||t.webkitURL||t},n=t.document.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in n,o=/constructor/i.test(t.HTMLElement)||t.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),i=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},s=function(t){setTimeout(function(){"string"==typeof t?e().revokeObjectURL(t):t.remove()},4e4)},c=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},l=function(l,u,f){f||(l=c(l));var p,d=this,h="application/octet-stream"===l.type,m=function(){!function(t,e,n){for(var r=(e=[].concat(e)).length;r--;){var o=t["on"+e[r]];if("function"==typeof o)try{o.call(t,n||t)}catch(t){i(t)}}}(d,"writestart progress write writeend".split(" "))};if(d.readyState=d.INIT,r)return p=e().createObjectURL(l),void setTimeout(function(){var t,e;n.href=p,n.download=u,t=n,e=new MouseEvent("click"),t.dispatchEvent(e),m(),s(p),d.readyState=d.DONE});!function(){if((a||h&&o)&&t.FileReader){var n=new FileReader;return n.onloadend=function(){var e=a?n.result:n.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,d.readyState=d.DONE,m()},n.readAsDataURL(l),void(d.readyState=d.INIT)}p||(p=e().createObjectURL(l)),h?t.location.href=p:t.open(p,"_blank")||(t.location.href=p);d.readyState=d.DONE,m(),s(p)}()},u=l.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,n){return e=e||t.name||"download",n||(t=c(t)),navigator.msSaveOrOpenBlob(t,e)}:(u.abort=function(){},u.readyState=u.INIT=0,u.WRITING=1,u.DONE=2,u.error=u.onwritestart=u.onprogress=u.onwrite=u.onabort=u.onerror=u.onwriteend=null,function(t,e,n){return new l(t,e||t.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */void 0!==t&&t.exports?t.exports.saveAs=o:null!==n(6)&&null!==n(5)&&(void 0===(r=function(){return o}.call(e,n,e,t))||(t.exports=r))},function(t,e,n){var r,o=function(){var t=String.fromCharCode,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function o(t,e){if(!r[t]){r[t]={};for(var n=0;n<t.length;n++)r[t][t.charAt(n)]=n}return r[t][e]}var a={compressToBase64:function(t){if(null==t)return"";var n=a._compress(t,6,function(t){return e.charAt(t)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:a._decompress(t.length,32,function(n){return o(e,t.charAt(n))})},compressToUTF16:function(e){return null==e?"":a._compress(e,15,function(e){return t(e+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:a._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(t){for(var e=a.compress(t),n=new Uint8Array(2*e.length),r=0,o=e.length;r<o;r++){var i=e.charCodeAt(r);n[2*r]=i>>>8,n[2*r+1]=i%256}return n},decompressFromUint8Array:function(e){if(null===e||void 0===e)return a.decompress(e);for(var n=new Array(e.length/2),r=0,o=n.length;r<o;r++)n[r]=256*e[2*r]+e[2*r+1];var i=[];return n.forEach(function(e){i.push(t(e))}),a.decompress(i.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":a._compress(t,6,function(t){return n.charAt(t)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),a._decompress(t.length,32,function(e){return o(n,t.charAt(e))}))},compress:function(e){return a._compress(e,16,function(e){return t(e)})},_compress:function(t,e,n){if(null==t)return"";var r,o,a,i={},s={},c="",l="",u="",f=2,p=3,d=2,h=[],m=0,g=0;for(a=0;a<t.length;a+=1)if(c=t.charAt(a),Object.prototype.hasOwnProperty.call(i,c)||(i[c]=p++,s[c]=!0),l=u+c,Object.prototype.hasOwnProperty.call(i,l))u=l;else{if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(r=0;r<d;r++)m<<=1,g==e-1?(g=0,h.push(n(m)),m=0):g++;for(o=u.charCodeAt(0),r=0;r<8;r++)m=m<<1|1&o,g==e-1?(g=0,h.push(n(m)),m=0):g++,o>>=1}else{for(o=1,r=0;r<d;r++)m=m<<1|o,g==e-1?(g=0,h.push(n(m)),m=0):g++,o=0;for(o=u.charCodeAt(0),r=0;r<16;r++)m=m<<1|1&o,g==e-1?(g=0,h.push(n(m)),m=0):g++,o>>=1}0==--f&&(f=Math.pow(2,d),d++),delete s[u]}else for(o=i[u],r=0;r<d;r++)m=m<<1|1&o,g==e-1?(g=0,h.push(n(m)),m=0):g++,o>>=1;0==--f&&(f=Math.pow(2,d),d++),i[l]=p++,u=String(c)}if(""!==u){if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(r=0;r<d;r++)m<<=1,g==e-1?(g=0,h.push(n(m)),m=0):g++;for(o=u.charCodeAt(0),r=0;r<8;r++)m=m<<1|1&o,g==e-1?(g=0,h.push(n(m)),m=0):g++,o>>=1}else{for(o=1,r=0;r<d;r++)m=m<<1|o,g==e-1?(g=0,h.push(n(m)),m=0):g++,o=0;for(o=u.charCodeAt(0),r=0;r<16;r++)m=m<<1|1&o,g==e-1?(g=0,h.push(n(m)),m=0):g++,o>>=1}0==--f&&(f=Math.pow(2,d),d++),delete s[u]}else for(o=i[u],r=0;r<d;r++)m=m<<1|1&o,g==e-1?(g=0,h.push(n(m)),m=0):g++,o>>=1;0==--f&&(f=Math.pow(2,d),d++)}for(o=2,r=0;r<d;r++)m=m<<1|1&o,g==e-1?(g=0,h.push(n(m)),m=0):g++,o>>=1;for(;;){if(m<<=1,g==e-1){h.push(n(m));break}g++}return h.join("")},decompress:function(t){return null==t?"":""==t?null:a._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(e,n,r){var o,a,i,s,c,l,u,f=[],p=4,d=4,h=3,m="",g=[],y={val:r(0),position:n,index:1};for(o=0;o<3;o+=1)f[o]=o;for(i=0,c=Math.pow(2,2),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),i|=(s>0?1:0)*l,l<<=1;switch(i){case 0:for(i=0,c=Math.pow(2,8),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),i|=(s>0?1:0)*l,l<<=1;u=t(i);break;case 1:for(i=0,c=Math.pow(2,16),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),i|=(s>0?1:0)*l,l<<=1;u=t(i);break;case 2:return""}for(f[3]=u,a=u,g.push(u);;){if(y.index>e)return"";for(i=0,c=Math.pow(2,h),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),i|=(s>0?1:0)*l,l<<=1;switch(u=i){case 0:for(i=0,c=Math.pow(2,8),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),i|=(s>0?1:0)*l,l<<=1;f[d++]=t(i),u=d-1,p--;break;case 1:for(i=0,c=Math.pow(2,16),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),i|=(s>0?1:0)*l,l<<=1;f[d++]=t(i),u=d-1,p--;break;case 2:return g.join("")}if(0==p&&(p=Math.pow(2,h),h++),f[u])m=f[u];else{if(u!==d)return null;m=a+a.charAt(0)}g.push(m),f[d++]=a+m.charAt(0),a=m,0==--p&&(p=Math.pow(2,h),h++)}}};return a}();void 0===(r=function(){return o}.call(e,n,e,t))||(t.exports=r)},function(t,e,n){"use strict";var r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const o=n(0),a=n(8),i=n(7);var s=n(4);const c=s.VERSION_RAILROAD,l=s.VERSION_STATION;n(3);const u=n(2);function f(){!function(){delete JRP.state.lineName,delete JRP.state.company,JRP.state.lineObjects.length&&(JRP.state.lineObjects.forEach(t=>t.setMap(null)),delete JRP.state.lineObjects);delete JRP.state.lineFeatures}(),delete JRP.state.startStation,delete JRP.state.startFeature,JRP.state.startObject&&(JRP.state.startObject.setMap(null),delete JRP.state.startObject),delete JRP.state.endStation,delete JRP.state.endFeature,JRP.state.endObject&&(JRP.state.endObject.setMap(null),delete JRP.state.endObject),function(){for(const t in JRP.tempPolylines)JRP.tempPolylines[t].forEach(t=>t.setMap(null)),delete JRP.tempPolylines[t];for(const t in JRP.tempMarkers)JRP.tempMarkers[t].setMap(null),delete JRP.tempMarkers[t]}()}function p(t,e){return JRP.railroads.features.filter(n=>n.properties.lineName===t&&n.properties.company===e)}function d(t){return JRP.stations.features.filter(e=>e.properties.groupId===t)[0]}function h(){return!JRP.state.startStation}function m(t,e){const n=_make("span",{class:"name-primary"});n.textContent=t;const r=_make("span",{class:"name-secondary"});r.textContent=e;const o=_make("li",{class:"item-item search-item"});return o.appendChild(n),o.appendChild(r),o}function g(t){$(".search-result").innerHTML="";const e=this.value.trim();""!==e&&function(t){const e=[],n={};return JRP.railroads.features.filter(e=>e.properties.lineName.includes(t)||e.properties.company.includes(t)).forEach(t=>{const r=t.properties.lineName+"ÿ"+t.properties.company;r in n||(n[r]=!0,e.push([t.properties.lineName,t.properties.company]))}),e}(e).forEach(([t,e])=>{const n=m(t,e);n.setAttribute("data-key",t+"ÿ"+e),n.addEventListener("mouseenter",y),n.addEventListener("mouseleave",v),n.addEventListener("click",b),$(".search-result").appendChild(n)})}function y(t){const e=this.getAttribute("data-key");var n=e.split("ÿ"),o=r(n,2);const a=o[0],i=o[1];if(JRP.tempPolylines[e])return;const s=[];p(a,i).forEach(t=>{const e=t.geometry.coordinates.map(([t,e])=>({lat:e,lng:t})),n=new google.maps.Polyline({path:e,strokeColor:"#FF0000",strokeWeight:1,map:JRP.map});s.push(n)}),JRP.tempPolylines[e]=s}function v(t){const e=this.getAttribute("data-key"),n=JRP.tempPolylines[e];if(n){for(let t=0;t<n.length;t++)n[t].setMap(null),delete n[t];delete JRP.tempPolylines[e]}}function b(t){var e=this.getAttribute("data-key").split("ÿ"),n=r(e,2);const o=n[0],a=n[1];!function(t,e){const n=t+"ÿ"+e;JRP.state.lineName=t,JRP.state.company=e,JRP.state.lineFeatures=p(t,e),JRP.state.lineObjects=JRP.tempPolylines[n],delete JRP.tempPolylines[n]}(o,a),$(".search-state").$show("table"),$(".state-current").textContent=o,$(".search-input input").removeEventListener("input",g),$(".search-input input").setAttribute("disabled","disabled"),$(".search-result").innerHTML="",function(t,e){const n=JRP.stations.features.filter(n=>n.properties.lineName===t&&n.properties.company===e);return n.sort((t,e)=>t.properties.groupId.localeCompare(e.properties.groupId)),n.map(t=>[t.properties.stationName,t.properties.groupId])}(o,a).forEach(([t,e])=>{const n=m(t,e);n.setAttribute("data-key",e),n.addEventListener("mouseenter",P),n.addEventListener("mouseleave",w),n.addEventListener("click",x),$(".search-result").appendChild(n)})}function P(t){const e=this.getAttribute("data-key"),n=d(e);var o=r(n.geometry.coordinates,2);const a=o[0],i=o[1],s=new google.maps.Marker({position:{lat:i,lng:a},label:h()?"A":"B",map:JRP.map});JRP.tempMarkers[e]=s;const c=this.$(".name-primary").textContent;h()?$(".state-start").textContent=c:$(".state-end").textContent=c}function w(t){const e=this.getAttribute("data-key");JRP.tempMarkers[e]&&(JRP.tempMarkers[e].setMap(null),delete JRP.tempMarkers[e])}function x(t){const e=this.getAttribute("data-key");var n;h()?(n=e,JRP.state.startStation=n,JRP.state.startFeature=d(n),JRP.state.startObject=JRP.tempMarkers[n],delete JRP.tempMarkers[n],$(".state-start").textContent=this.$(".name-primary").textContent):(!function(t){JRP.state.endStation=t,JRP.state.endFeature=d(t),JRP.state.endObject=JRP.tempMarkers[t],delete JRP.tempMarkers[t]}(e),$(".state-end").textContent=this.$(".name-primary").textContent,k(JRP.state.lineFeatures,JRP.state.startFeature,JRP.state.endFeature),M())}function M(){f(),$(".search-state").$hide(),$(".state-current").textContent="",$(".state-start").textContent="",$(".state-end").textContent="",$(".search-input input").value="",$(".search-input input").addEventListener("input",g),$(".search-input input").removeAttribute("disabled"),$(".search-result").innerHTML=""}function k(t,e,n){const r=u(t,e,n);if(!1===r)return alert("Unable to find a route"),void M();const o=JRP.plots.length,a={coordinates:r,properties:{lineName:t[0].properties.lineName,company:t[0].properties.company,start:e.properties.groupId,startName:e.properties.stationName,end:n.properties.groupId,endName:n.properties.stationName,color:"#000000",width:1},object:new google.maps.Polyline({path:r.map(([t,e])=>({lat:e,lng:t})),strokeColor:"#000000",strokeWeight:1,map:JRP.map})};JRP.plots.push(a);const i=function(t,e){const n=_make("span",{class:"name-primary"});n.textContent=t;const r=_make("span",{class:"name-secondary"});r.textContent=e;const o=_make("button",{class:"action-delete"});o.textContent="삭제";const a=_make("button",{class:"action-color"});a.innerHTML="색 (<var>#000000</var>)";const i=_make("button",{class:"action-width"});i.innerHTML="두께 (<var>1</var>)";const s=_make("div",{class:"plot-controls"});s.appendChild(o),s.appendChild(a),s.appendChild(i);const c=_make("li",{class:"item-item plot-item"});return c.appendChild(n),c.appendChild(r),c.appendChild(s),c}(a.properties.lineName,a.properties.startName+" → "+a.properties.endName);return i.setAttribute("data-index",o),i.$(".action-delete").addEventListener("click",E),i.$(".action-color").addEventListener("click",R),i.$(".action-width").addEventListener("click",J),$(".plot-list").appendChild(i),o}function E(t){const e=this.parentNode.parentNode,n=parseInt(e.getAttribute("data-index"));log("delete",n),e.parentNode.removeChild(e);for(let t=n+1;t<JRP.plots.length;t++)log("index",t),$(".plot-item[data-index='"+t+"']").setAttribute("data-index",t-1);JRP.plots[n].object.setMap(null),JRP.plots.splice(n,1)}function R(t,e){"number"!=typeof t&&(t=parseInt(this.parentNode.parentNode.getAttribute("data-index"))),"string"!=typeof e&&(e=prompt("새로운 색상 (#xxxxxx 형태)").trim()),e&&/^#[0-9a-f]{6}$/i.test(e)&&(JRP.plots[t].object.set("strokeColor",e),JRP.plots[t].properties.color=e,$(".plot-item[data-index='"+t+"'] .action-color var").textContent=e)}function J(t,e){"number"!=typeof t&&(t=parseInt(this.parentNode.parentNode.getAttribute("data-index"))),"number"!=typeof e&&(e=parseFloat(prompt("새로운 너비 (숫자)").trim())),e&&!Number.isNaN(e)&&(JRP.plots[t].object.set("strokeWeight",e),JRP.plots[t].properties.width=e,$(".plot-item[data-index='"+t+"'] .action-width var").textContent=e)}function A(){const t=JSON.stringify(JRP.plots.map(t=>t.properties)),e=a.compressToBase64(t);$(".modal-export-jrp").$show(),$(".modal-export-jrp textarea").value=e,$(".modal-export-jrp textarea").select()}function S(){$(".modal-import-jrp").$show(),$(".modal-import-jrp textarea").value="",$(".modal-import-jrp textarea").focus()}function j(){const t=$(".modal-import-jrp textarea").value.trim();if(""===t)return;const e=a.decompressFromBase64(t);null===e&&alert("올바르지 않은 데이터입니다.");try{const t=JSON.parse(e);for(const e of t){const t=(n=e.lineName,r=e.company,o=e.start,i=e.end,k(p(n,r),d(o),d(i)));R(t,e.color),J(t,e.width)}}catch(t){alert("올바르지 않은 데이터입니다."),log(t),log(e)}var n,r,o,i}function C(){const t=[];JRP.plots.forEach(e=>{t.push(`${e.properties.company} - ${e.properties.lineName} - `+`${e.properties.startName} -> ${e.properties.endName}`),t.push(google.maps.geometry.encoding.encodePath(e.object.getPath()))});const e=t.join("\n");$(".modal-export-polyline").$show(),$(".modal-export-polyline textarea").value=e,$(".modal-export-polyline textarea").select()}function L(){const t=[],e=new Date,n={},r=[];t.push('<?xml version="1.0" encoding="UTF-8"?>'),t.push('<kml xmlns="http://www.opengis.net/kml/2.2">'),t.push("<Document>"),t.push(`<name>Japan Railroad Plotter (${e.toISOString()})</name>`),JRP.plots.forEach(t=>{const e=t.properties.color,o=t.properties.width,a=e.substr(1),i=e.substr(5,2)+e.substr(3,2)+e.substr(1,2),s=`line-${a}-${Math.round(1e3*o)}`;n[s]=["<LineStyle>",`<color>ff${i}</color>`,`<width>${o}</width>`,"</LineStyle>"].join("");const c=["<Placemark>",`<name>${t.properties.startName} → ${t.properties.endName}</name>`,`<description><![CDATA[${t.properties.company}<br>${t.properties.lineName}]]></description>`,`<styleUrl>#${s}</styleUrl>`,"<LineString>","<tessellate>1</tessellate>","<coordinates>",t.coordinates.map(([t,e])=>`${t.toFixed(5)},${e.toFixed(5)},0`).join("\n"),"</coordinates>","</LineString>","</Placemark>"].join("");r.push(c)});for(const e in n)t.push(`<Style id="${e}">${n[e]}</Style>`);for(const e of r)t.push(e);t.push("</Document>"),t.push("</kml>");const o=t.join("\n"),a=new Blob([o],{type:"application/vnd.google-earth.kml+xml; charset=utf-8"}),s=`Japan Railroad Plotter (${e.toISOString()}).kml`;i.saveAs(a,s)}function N(){$("body").classList.add("hide-hover")}function O(){$("body").classList.remove("hide-hover")}window.JRP={state:{},plots:[],tempPolylines:{},tempMarkers:{}},async function(){$(".loading").$show(),await async function(){const t=JSON.parse(localStorage.getItem("revision"))||{railroad:0,station:0},e=localStorage.getItem("railroad"),n=localStorage.getItem("station");if(t.railroad<c||!e){log("railroad cache is outdated, downloading");const t=await(await fetch("data/japan-railway-railroad.json?r="+c)).text();JRP.railroad=JSON.parse(t),log("saving railroad cache, compressing");const e=a.compressToUTF16(t);localStorage.setItem("railroad",e)}else{log("railroad cache is up to date, decompressing");const t=a.decompressFromUTF16(e);JRP.railroad=JSON.parse(t)}if(t.station<l||!n){log("station cache is outdated, downloading");const t=await(await fetch("data/japan-railway-station.json?r="+l)).text();JRP.station=JSON.parse(t),log("saving station cache, compressing");const e=a.compressToUTF16(t);localStorage.setItem("station",e)}else{log("station cache is up to date, decompressing");const t=a.decompressFromUTF16(n);JRP.station=JSON.parse(t)}log("JRP data loaded");const r={railroad:c,station:l};localStorage.setItem("revision",JSON.stringify(r)),log("JRP data converting"),JRP.railroads=o.feature(JRP.railroad,JRP.railroad.objects.railroads),JRP.stations=o.feature(JRP.station,JRP.station.objects.stations),log("everything has loaded, ready to go!")}(),function(){const t=location.hostname,e="https://maps.googleapis.com/maps/api/js?libraries=geometry",n=document.createElement("script");n.type="text/javascript","localhost"===t?n.src=e:t.match(/snack\.studio$/)?n.src=e+"&key=AIzaSyDXfYkzPkfNqI8ZjHsgzuraxhOjMsPg-O8":n.src=e,n.addEventListener("load",function(){JRP.map=new google.maps.Map($("#google-map"),{center:{lat:37,lng:137},zoom:5})}),document.head.appendChild(n)}(),$(".search-input input").addEventListener("input",g),$(".state-cancel").addEventListener("click",M),$$(".modal .modal-close").forEach(t=>t.addEventListener("click",function(){this.parentNode.parentNode.$hide()})),$(".import-jrp").addEventListener("click",S),$(".modal-action-import-jrp").addEventListener("click",j),$(".export-jrp").addEventListener("click",A),$(".export-polyline").addEventListener("click",C),$(".export-kml").addEventListener("click",L),$(".button-hide-hover").addEventListener("click",N),$(".button-show-hover").addEventListener("click",O),$(".loading").$hide()}().then(()=>{}).catch(t=>{console.error(t)})}]);