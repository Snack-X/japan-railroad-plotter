!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/dist/",r(r.s=2)}([function(t,e){var r=function(t,e){return this instanceof r?t instanceof r?t:("string"==typeof t&&(t=this.select(t,e)),t&&t.nodeName&&(t=[t]),void(this.nodes=this.slice(t))):new r(t,e)};r.prototype={get length(){return this.nodes.length}},r.prototype.nodes=[],r.prototype.addClass=function(){return this.eacharg(arguments,function(t,e){t.classList.add(e)})},r.prototype.adjacent=function(t,e,n){return"number"==typeof e&&(e=0===e?[]:new Array(e).join().split(",").map(Number.call,Number)),this.each(function(o,i){var a=document.createDocumentFragment();r(e||{}).map(function(e,n){var a="function"==typeof t?t.call(this,e,n,o,i):t;return"string"==typeof a?this.generate(a):r(a)}).each(function(t){this.isInPage(t)?a.appendChild(r(t).clone().first()):a.appendChild(t)}),n.call(this,o,a)})},r.prototype.after=function(t,e){return this.adjacent(t,e,function(t,e){t.parentNode.insertBefore(e,t.nextSibling)})},r.prototype.append=function(t,e){return this.adjacent(t,e,function(t,e){t.appendChild(e)})},r.prototype.args=function(t,e,r){return"function"==typeof t&&(t=t(e,r)),"string"!=typeof t&&(t=this.slice(t).map(this.str(e,r))),t.toString().split(/[\s,]+/).filter(function(t){return t.length})},r.prototype.array=function(t){t=t;var e=this;return this.nodes.reduce(function(n,o,i){var a;return t?((a=t.call(e,o,i))||(a=!1),"string"==typeof a&&(a=r(a)),a instanceof r&&(a=a.nodes)):a=o.innerHTML,n.concat(!1!==a?a:[])},[])},r.prototype.attr=function(t,e,r){return r=r?"data-":"",this.pairs(t,e,function(t,e){return t.getAttribute(r+e)},function(t,e,n){t.setAttribute(r+e,n)})},r.prototype.before=function(t,e){return this.adjacent(t,e,function(t,e){t.parentNode.insertBefore(e,t)})},r.prototype.children=function(t){return this.map(function(t){return this.slice(t.children)}).filter(t)},r.prototype.clone=function(){return this.map(function(t,e){var r=t.cloneNode(!0),n=this.getAll(r);return this.getAll(t).each(function(t,e){for(var r in this.mirror)this.mirror[r]&&this.mirror[r](t,n.nodes[e])}),r})},r.prototype.getAll=function(t){return r([t].concat(r("*",t).nodes))},r.prototype.mirror={},r.prototype.mirror.events=function(t,e){if(t._e)for(var n in t._e)t._e[n].forEach(function(t){r(e).on(n,t)})},r.prototype.mirror.select=function(t,e){r(t).is("select")&&(e.value=t.value)},r.prototype.mirror.textarea=function(t,e){r(t).is("textarea")&&(e.value=t.value)},r.prototype.closest=function(t){return this.map(function(e){do{if(r(e).is(t))return e}while((e=e.parentNode)&&e!==document)})},r.prototype.data=function(t,e){return this.attr(t,e,!0)},r.prototype.each=function(t){return this.nodes.forEach(t.bind(this)),this},r.prototype.eacharg=function(t,e){return this.each(function(r,n){this.args(t,r,n).forEach(function(t){e.call(this,r,t)},this)})},r.prototype.empty=function(){return this.each(function(t){for(;t.firstChild;)t.removeChild(t.firstChild)})},r.prototype.filter=function(t){var e=function(e){return e.matches=e.matches||e.msMatchesSelector||e.webkitMatchesSelector,e.matches(t||"*")};return"function"==typeof t&&(e=t),t instanceof r&&(e=function(e){return-1!==t.nodes.indexOf(e)}),r(this.nodes.filter(e))},r.prototype.find=function(t){return this.map(function(e){return r(t||"*",e)})},r.prototype.first=function(){return this.nodes[0]||!1},r.prototype.generate=function(t){return/^\s*<tr[> ]/.test(t)?r(document.createElement("table")).html(t).children().children().nodes:/^\s*<t(h|d)[> ]/.test(t)?r(document.createElement("table")).html(t).children().children().children().nodes:/^\s*</.test(t)?r(document.createElement("div")).html(t).children().nodes:document.createTextNode(t)},r.prototype.handle=function(){var t=this.slice(arguments).map(function(t){return"function"==typeof t?function(e){e.preventDefault(),t.apply(this,arguments)}:t},this);return this.on.apply(this,t)},r.prototype.hasClass=function(){return this.is("."+this.args(arguments).join("."))},r.prototype.html=function(t){return void 0===t?this.first().innerHTML||"":this.each(function(e){e.innerHTML=t})},r.prototype.is=function(t){return 0<this.filter(t).length},r.prototype.isInPage=function(t){return t!==document.body&&document.body.contains(t)},r.prototype.last=function(){return this.nodes[this.length-1]||!1},r.prototype.map=function(t){return t?r(this.array(t)).unique():this},r.prototype.not=function(t){return this.filter(function(e){return!r(e).is(t||!0)})},r.prototype.off=function(t){return this.eacharg(t,function(t,e){r(t._e?t._e[e]:[]).each(function(r){t.removeEventListener(e,r)})})},r.prototype.on=function(t,e,n){if("string"==typeof e){var o=e;e=function(t){var e=arguments;r(t.currentTarget).find(o).each(function(r){if(r===t.target||r.contains(t.target)){try{Object.defineProperty(t,"currentTarget",{get:function(){return r}})}catch(r){}n.apply(r,e)}})}}var i=function(t){return e.apply(this,[t].concat(t.detail||[]))};return this.eacharg(t,function(t,e){t.addEventListener(e,i),t._e=t._e||{},t._e[e]=t._e[e]||[],t._e[e].push(i)})},r.prototype.pairs=function(t,e,r,n){if(void 0!==e){var o=t;(t={})[o]=e}return"object"==typeof t?this.each(function(e){for(var r in t)n(e,r,t[r])}):this.length?r(this.first(),t):""},r.prototype.param=function(t){return Object.keys(t).map(function(e){return this.uri(e)+"="+this.uri(t[e])}.bind(this)).join("&")},r.prototype.parent=function(t){return this.map(function(t){return t.parentNode}).filter(t)},r.prototype.prepend=function(t,e){return this.adjacent(t,e,function(t,e){t.insertBefore(e,t.firstChild)})},r.prototype.remove=function(){return this.each(function(t){t.parentNode&&t.parentNode.removeChild(t)})},r.prototype.removeClass=function(){return this.eacharg(arguments,function(t,e){t.classList.remove(e)})},r.prototype.replace=function(t,e){var n=[];return this.adjacent(t,e,function(t,e){n=n.concat(this.slice(e.children)),t.parentNode.replaceChild(e,t)}),r(n)},r.prototype.scroll=function(){return this.first().scrollIntoView({behavior:"smooth"}),this},r.prototype.select=function(t,e){return t=t.replace(/^\s*/,"").replace(/\s*$/,""),/^</.test(t)?r().generate(t):(e||document).querySelectorAll(t)},r.prototype.serialize=function(){var t=this;return this.slice(this.first().elements).reduce(function(e,n){return!n.name||n.disabled||"file"===n.type?e:/(checkbox|radio)/.test(n.type)&&!n.checked?e:"select-multiple"===n.type?(r(n.options).each(function(r){r.selected&&(e+="&"+t.uri(n.name)+"="+t.uri(r.value))}),e):e+"&"+t.uri(n.name)+"="+t.uri(n.value)},"").slice(1)},r.prototype.siblings=function(t){return this.parent().children(t).not(this)},r.prototype.size=function(){return this.first().getBoundingClientRect()},r.prototype.slice=function(t){return t&&0!==t.length&&"string"!=typeof t&&"[object Function]"!==t.toString()?t.length?[].slice.call(t.nodes||t):[t]:[]},r.prototype.str=function(t,e){return function(r){return"function"==typeof r?r.call(this,t,e):r.toString()}},r.prototype.text=function(t){return void 0===t?this.first().textContent||"":this.each(function(e){e.textContent=t})},r.prototype.toggleClass=function(t,e){return!!e===e?this[e?"addClass":"removeClass"](t):this.eacharg(t,function(t,e){t.classList.toggle(e)})},r.prototype.trigger=function(t){var e=this.slice(arguments).slice(1);return this.eacharg(t,function(t,r){var n,o={bubbles:!0,cancelable:!0,detail:e};try{n=new window.CustomEvent(r,o)}catch(t){(n=document.createEvent("CustomEvent")).initCustomEvent(r,!0,!0,e)}t.dispatchEvent(n)})},r.prototype.unique=function(){return r(this.nodes.reduce(function(t,e){return null!=e&&!1!==e&&-1===t.indexOf(e)?t.concat(e):t},[]))},r.prototype.uri=function(t){return encodeURIComponent(t).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")},r.prototype.wrap=function(t){return this.map(function(e){return r(t).each(function(t){(function(t){for(;t.firstElementChild;)t=t.firstElementChild;return r(t)})(t).append(e.cloneNode(!0)),e.parentNode.replaceChild(t,e)})})},"object"==typeof t&&t.exports&&(t.exports=r,t.exports.u=r)},function(t,e,r){"use strict";function n(t,e,r,n){const o=(r-t)*Math.PI/180,i=(n-e)*Math.PI/180,a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371e3*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}t.exports={geo:{length:function(t){if(t.length<2)return 0;let e=0;for(let r=1;r<t.length;r++)e+=n(t[r-1][1],t[r-1][0],t[r][1],t[r][0]);return e},distance:n,compare:function(t,e,r,n){return Math.round(1e5*t)===Math.round(1e5*r)&&Math.round(1e5*e)===Math.round(1e5*n)}},hash32:function(t){let e=5381,r=t.length;for(;r;)e=33*e^t.charCodeAt(--r);return e>>>0}}},function(t,e,r){"use strict";var n=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();r(3);const o=r(5),i=r(0);i.prototype.removeAttr=function(t){this.each(e=>e.removeAttribute(t))};const a=r(6);var s=r(8);const c=s.REV_RAILROAD,l=s.REV_STATION,u=r(9),h=(...t)=>{console.log(`[${(new Date).toLocaleString()}]`,...t)},p=0,f=1,d=2,m=3;(new class{async start(){i(".loading").addClass("active"),await this.initJRPlotter(),this.initGoogleMaps(),this.initEvents(),this.state=p,this.plots=[],i(".loading").removeClass("active")}async initJRPlotter(){const t=JSON.parse(localStorage.getItem("revision"))||{railroad:0,station:0},e=localStorage.getItem("railroad"),r=localStorage.getItem("station");let n,i;if(t.railroad<c||!e){h("railroad cache is outdated, downloading");const t=await fetch("dist/data/railroad.json?r="+c),e=await t.text();n=JSON.parse(e),h("compressing and saving railroad cache");const r=o.compressToUTF16(e);localStorage.setItem("railroad",r)}else{h("railroad cache is up to date, decompressing");const t=o.decompressFromUTF16(e);n=JSON.parse(t)}if(t.station<l||!r){h("station cache is outdated, downloading");const t=await fetch("dist/data/station.json?r="+l),e=await t.text();i=JSON.parse(e),h("compressing and saving station cache, compressing");const r=o.compressToUTF16(e);localStorage.setItem("station",r)}else{h("station cache is up to date, decompressing");const t=o.decompressFromUTF16(r);i=JSON.parse(t)}h("JRP data loaded");const s={railroad:c,station:l};localStorage.setItem("revision",JSON.stringify(s)),h("Initializing JRPlotter"),this.JRP=new a(n,i),h("everything has loaded, ready to go!")}initGoogleMaps(){this.map=new google.maps.Map(i("#google-map").first(),{center:{lat:37,lng:137},zoom:5})}initEvents(){i(".button-hide-hovers").on("click",()=>{i("body").addClass("hovers-hidden")}),i(".button-show-hovers").on("click",()=>{i("body").removeClass("hovers-hidden")}),i(".search-input input").on("input",this.onSearchInput.bind(this)),i(".state-cancel").on("click",this.resetSearchState.bind(this)),i(".button-show-modal-import-jrp").on("click",()=>{i(".modal-import-jrp").addClass("active"),i(".modal-import-jrp textarea").value="",i(".modal-import-jrp textarea").focus()}),i(".button-show-modal-export-jrp").on("click",()=>{i(".modal-export-jrp").addClass("active"),i(".modal-export-jrp textarea").value=output,i(".modal-export-jrp textarea").select()}),i(".button-show-modal-export-polyline").on("click",()=>{i(".modal-export-polyline").addClass("active"),i(".modal-export-polyline textarea").value=output,i(".modal-export-polyline textarea").select()}),i(".button-show-modal-export-kml").on("click",()=>{}),i(".modal .modal-close").on("click",t=>{i(t.target).closest(".modal").removeClass("active")})}resetSearchState(){i(".search-result").empty(),i(".search-input input").removeAttr("disabled"),i(".search-input input").first().value="",i(".search-state").removeClass("active"),i(".state-current").text(""),i(".state-start").text(""),i(".state-end").text(""),this.state=p,delete this.stateRailroadType,delete this.stateRailroadHash,delete this.stateStartHash,delete this.stateEndHash,this.clearPreviewFeatures(),this.clearPreviewFeature(),delete this.previewFeatures,delete this.previewFeature,this.previewPolylines=this.statePolylines,this.previewMarker=this.stateMarker,this.clearPreviewFeatures(),this.clearPreviewFeature(),delete this.statePolylines,delete this.stateMarker}enableSearchState(t){i(".search-state").addClass("active"),i(".state-current").text(t),i(".search-input input").attr("disabled","disabled")}setSearchStateStation(t){this.state===d?i(".state-start").text(t):this.state===m&&i(".state-end").text(t)}onSearchInput(t){const e=t.target.value.trim();""!==e?(this.state=f,this.displayRailroadResults(e)):this.state=p}onRailroadMouseEnter(t){const e=i(t.target);if("line"===e.data("type")){const t=parseInt(e.data("hash")),r=this.JRP.getRailroadFeatures(t);this.previewFeatures=r}this.displayPreviewFeatures()}onRailroadMouseLeave(t){this.clearPreviewFeatures()}onRailroadClick(t){const e=i(t.target).closest(".search-item"),r=e.data("type"),n=parseInt(e.data("hash"));this.state=d,this.stateRailroadType=r,this.stateRailroadHash=n,this.statePolylines=this.previewPolylines,delete this.previewFeatures,delete this.previewPolylines,this.enableSearchState(e.find(".name-primary").text()),this.displayStationResults(r,n)}displayRailroadResults(t){i(".search-result").empty(),this.JRP.searchRailroads(t).forEach(t=>{let e;"line"===t.type&&(e=u.searchItem(t.line,t.company)).data("hash",t.hash),e.data("type",t.type),i(".search-result").append(e)}),i(".search-result .search-item").on("mouseenter",this.onRailroadMouseEnter.bind(this)).on("mouseleave",this.onRailroadMouseLeave.bind(this)).on("click",this.onRailroadClick.bind(this))}clearPreviewFeatures(){if(this.previewPolylines){for(let t=0;t<this.previewPolylines.length;t++)this.previewPolylines[t].setMap(null),delete this.previewPolylines[t];this.previewPolylines=[]}}displayPreviewFeatures(){this.clearPreviewFeatures();const t=this.previewFeatures.map(t=>new google.maps.Polyline({path:t.geometry.coordinates.map(([t,e])=>({lat:e,lng:t})),strokeColor:"#FF0000",strokeWeight:1,map:this.map}));this.previewPolylines=t}onStationMouseEnter(t){const e=i(t.target),r=parseInt(e.data("hash")),n=this.JRP.getStationFeature(r);this.setSearchStateStation(e.find(".name-primary").text()),this.previewFeature=n,this.displayPreviewFeature()}onStationMouseLeave(t){this.clearPreviewFeature()}onStationClick(t){const e=i(t.target).closest(".search-item"),r=parseInt(e.data("hash"));if(this.state===d)this.state=m,this.stateStartHash=r,this.stateMarker=this.previewMarker,delete this.previewFeature,delete this.previewMarker;else if(this.state===m){const t=this.stateRailroadType,e=this.stateRailroadHash,n=this.stateStartHash,o=r;this.addPlotItem(t,e,n,o),this.resetSearchState()}}displayStationResults(t,e){i(".search-result").empty();let r=[];"line"===t&&(r=this.JRP.getStationsFromLine(e)),r.forEach(t=>{const e=u.searchItem(t.name,t.id);e.data("hash",t.hash),i(".search-result").append(e)}),i(".search-result .search-item").on("mouseenter",this.onStationMouseEnter.bind(this)).on("mouseleave",this.onStationMouseLeave.bind(this)).on("click",this.onStationClick.bind(this))}clearPreviewFeature(){this.previewMarker&&(this.previewMarker.setMap(null),delete this.previewMarker)}displayPreviewFeature(){this.clearPreviewFeature();var t=n(this.previewFeature.geometry.coordinates,2);const e=t[0],r=t[1],o=new google.maps.Marker({position:{lat:r,lng:e},label:this.state===d?"始":"終",map:this.map});this.previewMarker=o}onPlotDelete(t){}onPlotChangeColor(t){}onPlotChangeWidth(t){}addPlotItem(t,e,r,n,o="#000000",a=1){const s=this.JRP.getRoute(t,e,r,n);if(!1===s)return void alert("Unable to find a route");const c=this.JRP.getRailroadFeatures(e)[0].properties.lineName,l=this.JRP.getStationFeature(r).properties.stationName,h=this.JRP.getStationFeature(n).properties.stationName,p=this.plots.length,f={lineString:s,properties:{type:t,lineName:c,lineHash:e,startName:l,startHash:r,endName:h,endHash:n,color:o,width:a},polyline:new google.maps.Polyline({path:s.map(([t,e])=>({lat:e,lng:t})),strokeColor:o,strokeWidth:a,map:this.map})};this.plots.push(f);const d=u.plotItem(c,`${l} → ${h}`,o,a);return d.data("index",p),d.find(".action-delete").on("click",this.onPlotDelete.bind(this)),d.find(".action-color").on("click",this.onPlotChangeColor.bind(this)),d.find(".action-width").on("click",this.onPlotChangeWidth.bind(this)),i(".plot-list").append(d),p}}).start().then(()=>{}).catch(t=>{console.error(t)})},function(t,e,r){},,function(t,e,r){var n,o=function(){var t=String.fromCharCode,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};function o(t,e){if(!n[t]){n[t]={};for(var r=0;r<t.length;r++)n[t][t.charAt(r)]=r}return n[t][e]}var i={compressToBase64:function(t){if(null==t)return"";var r=i._compress(t,6,function(t){return e.charAt(t)});switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:i._decompress(t.length,32,function(r){return o(e,t.charAt(r))})},compressToUTF16:function(e){return null==e?"":i._compress(e,15,function(e){return t(e+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:i._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(t){for(var e=i.compress(t),r=new Uint8Array(2*e.length),n=0,o=e.length;n<o;n++){var a=e.charCodeAt(n);r[2*n]=a>>>8,r[2*n+1]=a%256}return r},decompressFromUint8Array:function(e){if(null===e||void 0===e)return i.decompress(e);for(var r=new Array(e.length/2),n=0,o=r.length;n<o;n++)r[n]=256*e[2*n]+e[2*n+1];var a=[];return r.forEach(function(e){a.push(t(e))}),i.decompress(a.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":i._compress(t,6,function(t){return r.charAt(t)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),i._decompress(t.length,32,function(e){return o(r,t.charAt(e))}))},compress:function(e){return i._compress(e,16,function(e){return t(e)})},_compress:function(t,e,r){if(null==t)return"";var n,o,i,a={},s={},c="",l="",u="",h=2,p=3,f=2,d=[],m=0,g=0;for(i=0;i<t.length;i+=1)if(c=t.charAt(i),Object.prototype.hasOwnProperty.call(a,c)||(a[c]=p++,s[c]=!0),l=u+c,Object.prototype.hasOwnProperty.call(a,l))u=l;else{if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(n=0;n<f;n++)m<<=1,g==e-1?(g=0,d.push(r(m)),m=0):g++;for(o=u.charCodeAt(0),n=0;n<8;n++)m=m<<1|1&o,g==e-1?(g=0,d.push(r(m)),m=0):g++,o>>=1}else{for(o=1,n=0;n<f;n++)m=m<<1|o,g==e-1?(g=0,d.push(r(m)),m=0):g++,o=0;for(o=u.charCodeAt(0),n=0;n<16;n++)m=m<<1|1&o,g==e-1?(g=0,d.push(r(m)),m=0):g++,o>>=1}0==--h&&(h=Math.pow(2,f),f++),delete s[u]}else for(o=a[u],n=0;n<f;n++)m=m<<1|1&o,g==e-1?(g=0,d.push(r(m)),m=0):g++,o>>=1;0==--h&&(h=Math.pow(2,f),f++),a[l]=p++,u=String(c)}if(""!==u){if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(n=0;n<f;n++)m<<=1,g==e-1?(g=0,d.push(r(m)),m=0):g++;for(o=u.charCodeAt(0),n=0;n<8;n++)m=m<<1|1&o,g==e-1?(g=0,d.push(r(m)),m=0):g++,o>>=1}else{for(o=1,n=0;n<f;n++)m=m<<1|o,g==e-1?(g=0,d.push(r(m)),m=0):g++,o=0;for(o=u.charCodeAt(0),n=0;n<16;n++)m=m<<1|1&o,g==e-1?(g=0,d.push(r(m)),m=0):g++,o>>=1}0==--h&&(h=Math.pow(2,f),f++),delete s[u]}else for(o=a[u],n=0;n<f;n++)m=m<<1|1&o,g==e-1?(g=0,d.push(r(m)),m=0):g++,o>>=1;0==--h&&(h=Math.pow(2,f),f++)}for(o=2,n=0;n<f;n++)m=m<<1|1&o,g==e-1?(g=0,d.push(r(m)),m=0):g++,o>>=1;for(;;){if(m<<=1,g==e-1){d.push(r(m));break}g++}return d.join("")},decompress:function(t){return null==t?"":""==t?null:i._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(e,r,n){var o,i,a,s,c,l,u,h=[],p=4,f=4,d=3,m="",g=[],y={val:n(0),position:r,index:1};for(o=0;o<3;o+=1)h[o]=o;for(a=0,c=Math.pow(2,2),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=r,y.val=n(y.index++)),a|=(s>0?1:0)*l,l<<=1;switch(a){case 0:for(a=0,c=Math.pow(2,8),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=r,y.val=n(y.index++)),a|=(s>0?1:0)*l,l<<=1;u=t(a);break;case 1:for(a=0,c=Math.pow(2,16),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=r,y.val=n(y.index++)),a|=(s>0?1:0)*l,l<<=1;u=t(a);break;case 2:return""}for(h[3]=u,i=u,g.push(u);;){if(y.index>e)return"";for(a=0,c=Math.pow(2,d),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=r,y.val=n(y.index++)),a|=(s>0?1:0)*l,l<<=1;switch(u=a){case 0:for(a=0,c=Math.pow(2,8),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=r,y.val=n(y.index++)),a|=(s>0?1:0)*l,l<<=1;h[f++]=t(a),u=f-1,p--;break;case 1:for(a=0,c=Math.pow(2,16),l=1;l!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=r,y.val=n(y.index++)),a|=(s>0?1:0)*l,l<<=1;h[f++]=t(a),u=f-1,p--;break;case 2:return g.join("")}if(0==p&&(p=Math.pow(2,d),d++),h[u])m=h[u];else{if(u!==f)return null;m=i+i.charAt(0)}g.push(m),h[f++]=i+m.charAt(0),i=m,0==--p&&(p=Math.pow(2,d),d++)}}};return i}();void 0===(n=function(){return o}.call(e,r,e,t))||(t.exports=n)},function(t,e,r){"use strict";const n=r(10),o=r(7),i=r(1),a={line:1,series:2,route:3};t.exports=class{constructor(t,e){this.railroads=n.feature(t,t.objects.railroads),this.stations=n.feature(e,e.objects.stations),this.railroadHashes=new Map,this.stationHashes=new Map,this.mapLineStation=new Map;for(let t=0;t<this.railroads.features.length;t++){var r=this.railroads.features[t].properties;const e=r.company,n=r.lineName,o=i.hash32(`${e}ÿ${n}`);this.railroadHashes.has(o)||this.railroadHashes.set(o,{indexes:[],company:e,line:n}),this.railroadHashes.get(o).indexes.push(t)}for(let t=0;t<this.stations.features.length;t++){var o=this.stations.features[t].properties;const e=o.company,r=o.lineName,n=o.groupId,a=o.stationName,s=i.hash32(n);this.stationHashes.has(s)||this.stationHashes.set(s,{index:t,id:n,name:a,company:e,line:r});const c=i.hash32(`${e}ÿ${r}`);this.mapLineStation.has(c)||this.mapLineStation.set(c,[]),this.mapLineStation.get(c).push({index:t,hash:s,id:n,name:a})}}getRailroadFeatures(t){t=parseInt(t);const e=this.railroadHashes.get(t);return!!e&&e.indexes.map(t=>this.railroads.features[t])}searchRailroads(t){const e=[],r={};return this.railroads.features.filter(e=>e.properties.lineName.includes(t)||e.properties.company.includes(t)).forEach(t=>{const n=`${t.properties.company}ÿ${t.properties.lineName}`,o=i.hash32(n);o in r||(r[o]=!0,e.push({type:"line",hash:o,company:t.properties.company,line:t.properties.lineName,features:this.getRailroadFeatures(o)}))}),e.sort((t,e)=>a[t.type]-a[e.type]||t.company&&e.company&&t.company.localeCompare(e.company)||t.line.localeCompare(e.line)),e}getStationsFromLine(t){t=parseInt(t);const e=this.mapLineStation.get(t);return!!e&&(e.sort((t,e)=>t.id.localeCompare(e.id)),e)}getStationFeature(t){t=parseInt(t);const e=this.stationHashes.get(t);return!!e&&this.stations.features[e.index]}getRoute(t,e,r,n){let i;"line"===t&&(i=this.getRailroadFeatures(e).map(t=>t.geometry.coordinates));const a=this.getStationFeature(r),s=this.getStationFeature(n);if(!a||!s)return null;const c=a.geometry.coordinates,l=s.geometry.coordinates;return o(i,c,l)}}},function(t,e,r){"use strict";var n=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const o=r(1),i=-1,a=0,s=1,c=2,l=t=>[t[1],t[0]];function u(t,e){for(let r=0;r<t.length;r++){const n=t[r];for(let t=0;t<n.length;t++)if(o.geo.compare(...n[t],...e))return[r,t,!1]}for(let r=0;r<t.length;r++){const n=t[r];for(let t=0;t<n.length-1;t++){const i=o.geo.distance(...n[t],...e),a=o.geo.distance(...e,...n[t+1]),s=o.geo.distance(...n[t],...n[t+1]);if(Math.round(i+a)===Math.round(s))return[r,t,t+1]}}return!1}t.exports=function(t,e,r){e=l(e),r=l(r);const h=[],p={};for(let e=0,r=t.length;e<r;e++){const r=t[e].slice().map(l);h.push(r),p[e]={}}const f=h.length;let d=!1,m=u(h,e);if(!1===m)return!1;!1!==m[2]&&(d=!0,h[m[0]].splice(m[1],0,e));let g=u(h,r);if(!1===g)return!1;!1!==g[2]&&(d=!0,h[g[0]].splice(g[1],0,r)),d&&(m=u(h,e),g=u(h,r));for(let t=0;t<f;t++)for(let e=0;e<f;e++)for(let r of[0,h[t].length-1])for(let n=0;n<h[e].length;n++)t===e&&r===n||!o.geo.compare(...h[t][r],...h[e][n])||(p[t][r]=[e,n],p[e][n]=[t,r]);const y=function t(e,r,o,l,u=a,h=[]){const p=t.bind(null,e,r);const f=([t,e])=>h.includes(`${t}/${e}`);const d=[];var m=n(o,2);const g=m[0],y=m[1];var v=n(l,2);const b=v[0],w=v[1];g===b&&d.push([[g,y,w]]);h=[...h,`${g}/${y}`];let S=Object.keys(r[g]);S=S.map(t=>parseInt(t));S.sort((t,e)=>t-e);let M=[],x=!1,C=[];for(let t=0;t<S.length;t++){const e=S[t];e<y?M.push(e):y===e?x=r[g][e]:y<e&&C.push(e)}let P=!1,E=!1;M.length&&(P=Math.max(...M));C.length&&(E=Math.min(...C));const k=[g,P];if(!1!==P&&u!==s&&!f(k)){const t=p(k,l,i,h).map(t=>[[g,y,P],...t]);d.push(...t)}if(!1!==x&&!f(x)){const t=p(x,l,c,h);d.push(...t)}const F=[g,E];if(!1!==E&&u!==i&&!f(F)){const t=p(F,l,s,h).map(t=>[[g,y,E],...t]);d.push(...t)}return d}(h,p,m,g).map(t=>{const e=[].concat(...t.map(t=>{var e=n(t,3);e[0];let r=e[1],o=e[2];return r<o?h[t[0]].slice(r,o):h[t[0]].slice(o,r).reverse()}));return{lineString:e,candidate:t,segments:t.length,length:o.geo.length(e)}});return y.sort((t,e)=>t.length-e.length||t.segments-e.segments||t.lineString.length-e.lineString.length),y[0].lineString.map(l)}},function(t,e,r){"use strict";t.exports.REV_RAILROAD=1,t.exports.REV_STATION=4},function(t,e,r){"use strict";const n=r(0);t.exports.searchItem=((t,e)=>{const r=n("<span>").addClass("name-primary").text(t),o=n("<span>").addClass("name-secondary").text(e),i=n("<li>").addClass("item-item search-item");return i.append(r).append(o),i}),t.exports.plotItem=((t,e,r="#000000",o=1)=>{const i=n("<button>").addClass("action-delete").text("삭제"),a=n("<button>").addClass("action-color").html(`색 (<var>${r}</var>)`),s=n("<button>").addClass("action-width").html(`두께 (<var>${o}</var>)`),c=n("<div>").addClass("plot-controls");c.append(i).append(a).append(s);const l=n("<span>").addClass("name-primary").text(t),u=n("<span>").addClass("name-secondary").text(e),h=n("<li>").addClass("item-item plot-item");return h.append(l).append(u).append(c),h})},function(t,e,r){"use strict";r.r(e);var n=function(t){return t},o=function(t){if(null==t)return n;var e,r,o=t.scale[0],i=t.scale[1],a=t.translate[0],s=t.translate[1];return function(t,n){n||(e=r=0);var c=2,l=t.length,u=new Array(l);for(u[0]=(e+=t[0])*o+a,u[1]=(r+=t[1])*i+s;c<l;)u[c]=t[c],++c;return u}},i=function(t){var e,r=o(t.transform),n=1/0,i=n,a=-n,s=-n;function c(t){(t=r(t))[0]<n&&(n=t[0]),t[0]>a&&(a=t[0]),t[1]<i&&(i=t[1]),t[1]>s&&(s=t[1])}function l(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(l);break;case"Point":c(t.coordinates);break;case"MultiPoint":t.coordinates.forEach(c)}}for(e in t.arcs.forEach(function(t){for(var e,o=-1,c=t.length;++o<c;)(e=r(t[o],o))[0]<n&&(n=e[0]),e[0]>a&&(a=e[0]),e[1]<i&&(i=e[1]),e[1]>s&&(s=e[1])}),t.objects)l(t.objects[e]);return[n,i,a,s]},a=function(t,e){for(var r,n=t.length,o=n-e;o<--n;)r=t[o],t[o++]=t[n],t[n]=r},s=function(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return c(t,e)})}:c(t,e)};function c(t,e){var r=e.id,n=e.bbox,o=null==e.properties?{}:e.properties,i=l(t,e);return null==r&&null==n?{type:"Feature",properties:o,geometry:i}:null==n?{type:"Feature",id:r,properties:o,geometry:i}:{type:"Feature",id:r,bbox:n,properties:o,geometry:i}}function l(t,e){var r=o(t.transform),n=t.arcs;function i(t,e){e.length&&e.pop();for(var o=n[t<0?~t:t],i=0,s=o.length;i<s;++i)e.push(r(o[i],i));t<0&&a(e,s)}function s(t){return r(t)}function c(t){for(var e=[],r=0,n=t.length;r<n;++r)i(t[r],e);return e.length<2&&e.push(e[0]),e}function l(t){for(var e=c(t);e.length<4;)e.push(e[0]);return e}function u(t){return t.map(l)}return function t(e){var r,n=e.type;switch(n){case"GeometryCollection":return{type:n,geometries:e.geometries.map(t)};case"Point":r=s(e.coordinates);break;case"MultiPoint":r=e.coordinates.map(s);break;case"LineString":r=c(e.arcs);break;case"MultiLineString":r=e.arcs.map(c);break;case"Polygon":r=u(e.arcs);break;case"MultiPolygon":r=e.arcs.map(u);break;default:return null}return{type:n,coordinates:r}}(e)}var u=function(t,e){var r={},n={},o={},i=[],a=-1;function s(t,e){for(var n in t){var o=t[n];delete e[o.start],delete o.start,delete o.end,o.forEach(function(t){r[t<0?~t:t]=1}),i.push(o)}}return e.forEach(function(r,n){var o,i=t.arcs[r<0?~r:r];i.length<3&&!i[1][0]&&!i[1][1]&&(o=e[++a],e[a]=r,e[n]=o)}),e.forEach(function(e){var r,i,a=function(e){var r,n=t.arcs[e<0?~e:e],o=n[0];t.transform?(r=[0,0],n.forEach(function(t){r[0]+=t[0],r[1]+=t[1]})):r=n[n.length-1];return e<0?[r,o]:[o,r]}(e),s=a[0],c=a[1];if(r=o[s])if(delete o[r.end],r.push(e),r.end=c,i=n[c]){delete n[i.start];var l=i===r?r:r.concat(i);n[l.start=r.start]=o[l.end=i.end]=l}else n[r.start]=o[r.end]=r;else if(r=n[c])if(delete n[r.start],r.unshift(e),r.start=s,i=o[s]){delete o[i.end];var u=i===r?r:i.concat(r);n[u.start=i.start]=o[u.end=r.end]=u}else n[r.start]=o[r.end]=r;else n[(r=[e]).start=s]=o[r.end=c]=r}),s(o,n),s(n,o),e.forEach(function(t){r[t<0?~t:t]||i.push([t])}),i},h=function(t){return l(t,p.apply(this,arguments))};function p(t,e,r){var n,o,i;if(arguments.length>1)n=function(t,e,r){var n,o=[],i=[];function a(t){var e=t<0?~t:t;(i[e]||(i[e]=[])).push({i:t,g:n})}function s(t){t.forEach(a)}function c(t){t.forEach(s)}return function t(e){switch(n=e,e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"LineString":s(e.arcs);break;case"MultiLineString":case"Polygon":c(e.arcs);break;case"MultiPolygon":!function(t){t.forEach(c)}(e.arcs)}}(e),i.forEach(null==r?function(t){o.push(t[0].i)}:function(t){r(t[0].g,t[t.length-1].g)&&o.push(t[0].i)}),o}(0,e,r);else for(o=0,n=new Array(i=t.arcs.length);o<i;++o)n[o]=o;return{type:"MultiLineString",arcs:u(t,n)}}var f=function(t){return l(t,d.apply(this,arguments))};function d(t,e){var r={},n=[],o=[];function i(t){t.forEach(function(e){e.forEach(function(e){(r[e=e<0?~e:e]||(r[e]=[])).push(t)})}),n.push(t)}function a(e){return function(t){for(var e,r=-1,n=t.length,o=t[n-1],i=0;++r<n;)e=o,o=t[r],i+=e[0]*o[1]-e[1]*o[0];return Math.abs(i)}(l(t,{type:"Polygon",arcs:[e]}).coordinates[0])}return e.forEach(function t(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"Polygon":i(e.arcs);break;case"MultiPolygon":e.arcs.forEach(i)}}),n.forEach(function(t){if(!t._){var e=[],n=[t];for(t._=1,o.push(e);t=n.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){r[t<0?~t:t].forEach(function(t){t._||(t._=1,n.push(t))})})})}}),n.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:o.map(function(e){var n,o=[];if(e.forEach(function(t){t.forEach(function(t){t.forEach(function(t){r[t<0?~t:t].length<2&&o.push(t)})})}),(n=(o=u(t,o)).length)>1)for(var i,s,c=1,l=a(o[0]);c<n;++c)(i=a(o[c]))>l&&(s=o[0],o[0]=o[c],o[c]=s,l=i);return o})}}var m=function(t,e){for(var r=0,n=t.length;r<n;){var o=r+n>>>1;t[o]<e?r=o+1:n=o}return r},g=function(t){var e={},r=t.map(function(){return[]});function n(t,r){t.forEach(function(t){t<0&&(t=~t);var n=e[t];n?n.push(r):e[t]=[r]})}function o(t,e){t.forEach(function(t){n(t,e)})}var i={LineString:n,MultiLineString:o,Polygon:o,MultiPolygon:function(t,e){t.forEach(function(t){o(t,e)})}};for(var a in t.forEach(function t(e,r){"GeometryCollection"===e.type?e.geometries.forEach(function(e){t(e,r)}):e.type in i&&i[e.type](e.arcs,r)}),e)for(var s=e[a],c=s.length,l=0;l<c;++l)for(var u=l+1;u<c;++u){var h,p=s[l],f=s[u];(h=r[p])[a=m(h,f)]!==f&&h.splice(a,0,f),(h=r[f])[a=m(h,p)]!==p&&h.splice(a,0,p)}return r},y=function(t){if(null==t)return n;var e,r,o=t.scale[0],i=t.scale[1],a=t.translate[0],s=t.translate[1];return function(t,n){n||(e=r=0);var c=2,l=t.length,u=new Array(l),h=Math.round((t[0]-a)/o),p=Math.round((t[1]-s)/i);for(u[0]=h-e,e=h,u[1]=p-r,r=p;c<l;)u[c]=t[c],++c;return u}},v=function(t,e){if(t.transform)throw new Error("already quantized");if(e&&e.scale)c=t.bbox;else{if(!((r=Math.floor(e))>=2))throw new Error("n must be ≥2");var r,n=(c=t.bbox||i(t))[0],o=c[1],a=c[2],s=c[3];e={scale:[a-n?(a-n)/(r-1):1,s-o?(s-o)/(r-1):1],translate:[n,o]}}var c,l,u=y(e),h=t.objects,p={};function f(t){return u(t)}function d(t){var e;switch(t.type){case"GeometryCollection":e={type:"GeometryCollection",geometries:t.geometries.map(d)};break;case"Point":e={type:"Point",coordinates:f(t.coordinates)};break;case"MultiPoint":e={type:"MultiPoint",coordinates:t.coordinates.map(f)};break;default:return t}return null!=t.id&&(e.id=t.id),null!=t.bbox&&(e.bbox=t.bbox),null!=t.properties&&(e.properties=t.properties),e}for(l in h)p[l]=d(h[l]);return{type:"Topology",bbox:c,transform:e,objects:p,arcs:t.arcs.map(function(t){var e,r=0,n=1,o=t.length,i=new Array(o);for(i[0]=u(t[0],0);++r<o;)((e=u(t[r],r))[0]||e[1])&&(i[n++]=e);return 1===n&&(i[n++]=[0,0]),i.length=n,i})}};r.d(e,"bbox",function(){return i}),r.d(e,"feature",function(){return s}),r.d(e,"mesh",function(){return h}),r.d(e,"meshArcs",function(){return p}),r.d(e,"merge",function(){return f}),r.d(e,"mergeArcs",function(){return d}),r.d(e,"neighbors",function(){return g}),r.d(e,"quantize",function(){return v}),r.d(e,"transform",function(){return o}),r.d(e,"untransform",function(){return y})}]);