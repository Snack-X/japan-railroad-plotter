!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";const r=n(1),o=n(2);window.$=o;const i=n(3);var a=n(5);const s=a.VERSION_RAILROAD,c=a.VERSION_STATION,u=(...t)=>{console.log(`[${(new Date).toLocaleString()}]`,...t)};(new class{async start(){o(".loading").addClass("active"),await this.initJRPlotter(),this.initGoogleMaps(),this.initEvents(),o(".loading").removeClass("active")}async initJRPlotter(){const t=JSON.parse(localStorage.getItem("revision"))||{railroad:0,station:0},e=localStorage.getItem("railroad"),n=localStorage.getItem("station");let o,a;if(t.railroad<s||!e){u("railroad cache is outdated, downloading");const t=await fetch("dist/data/railroad.json?r="+s),e=await t.text();o=JSON.parse(e),u("compressing and saving railroad cache");const n=r.compressToUTF16(e);localStorage.setItem("railroad",n)}else{u("railroad cache is up to date, decompressing");const t=r.decompressFromUTF16(e);o=JSON.parse(t)}if(t.station<c||!n){u("station cache is outdated, downloading");const t=await fetch("dist/data/station.json?r="+c),e=await t.text();a=JSON.parse(e),u("compressing and saving station cache, compressing");const n=r.compressToUTF16(e);localStorage.setItem("station",n)}else{u("station cache is up to date, decompressing");const t=r.decompressFromUTF16(n);a=JSON.parse(t)}u("JRP data loaded");const l={railroad:s,station:c};localStorage.setItem("revision",JSON.stringify(l)),u("Initializing JRPlotter"),this.JRP=new i(o,a),u("everything has loaded, ready to go!")}initGoogleMaps(){this.map=new google.maps.Map(o("#google-map").first(),{center:{lat:37,lng:137},zoom:5})}initEvents(){o(".button-hide-hovers").on("click",()=>{o("body").addClass("hovers-hidden")}),o(".button-show-hovers").on("click",()=>{o("body").removeClass("hovers-hidden")}),o(".button-show-modal-import-jrp").on("click",()=>{o(".modal-import-jrp").addClass("active"),o(".modal-import-jrp textarea").value="",o(".modal-import-jrp textarea").focus()}),o(".button-show-modal-export-jrp").on("click",()=>{o(".modal-export-jrp").addClass("active"),o(".modal-export-jrp textarea").value=output,o(".modal-export-jrp textarea").select()}),o(".button-show-modal-export-polyline").on("click",()=>{o(".modal-export-polyline").addClass("active"),o(".modal-export-polyline textarea").value=output,o(".modal-export-polyline textarea").select()}),o(".button-show-modal-export-kml").on("click",()=>{}),o(".modal .modal-close").on("click",t=>{o(t.target).closest(".modal").removeClass("active")})}}).start().then(()=>{}).catch(t=>{console.error(t)})},function(t,e,n){var r,o=function(){var t=String.fromCharCode,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function o(t,e){if(!r[t]){r[t]={};for(var n=0;n<t.length;n++)r[t][t.charAt(n)]=n}return r[t][e]}var i={compressToBase64:function(t){if(null==t)return"";var n=i._compress(t,6,function(t){return e.charAt(t)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:i._decompress(t.length,32,function(n){return o(e,t.charAt(n))})},compressToUTF16:function(e){return null==e?"":i._compress(e,15,function(e){return t(e+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:i._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(t){for(var e=i.compress(t),n=new Uint8Array(2*e.length),r=0,o=e.length;r<o;r++){var a=e.charCodeAt(r);n[2*r]=a>>>8,n[2*r+1]=a%256}return n},decompressFromUint8Array:function(e){if(null===e||void 0===e)return i.decompress(e);for(var n=new Array(e.length/2),r=0,o=n.length;r<o;r++)n[r]=256*e[2*r]+e[2*r+1];var a=[];return n.forEach(function(e){a.push(t(e))}),i.decompress(a.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":i._compress(t,6,function(t){return n.charAt(t)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),i._decompress(t.length,32,function(e){return o(n,t.charAt(e))}))},compress:function(e){return i._compress(e,16,function(e){return t(e)})},_compress:function(t,e,n){if(null==t)return"";var r,o,i,a={},s={},c="",u="",l="",p=2,f=3,h=2,d=[],m=0,g=0;for(i=0;i<t.length;i+=1)if(c=t.charAt(i),Object.prototype.hasOwnProperty.call(a,c)||(a[c]=f++,s[c]=!0),u=l+c,Object.prototype.hasOwnProperty.call(a,u))l=u;else{if(Object.prototype.hasOwnProperty.call(s,l)){if(l.charCodeAt(0)<256){for(r=0;r<h;r++)m<<=1,g==e-1?(g=0,d.push(n(m)),m=0):g++;for(o=l.charCodeAt(0),r=0;r<8;r++)m=m<<1|1&o,g==e-1?(g=0,d.push(n(m)),m=0):g++,o>>=1}else{for(o=1,r=0;r<h;r++)m=m<<1|o,g==e-1?(g=0,d.push(n(m)),m=0):g++,o=0;for(o=l.charCodeAt(0),r=0;r<16;r++)m=m<<1|1&o,g==e-1?(g=0,d.push(n(m)),m=0):g++,o>>=1}0==--p&&(p=Math.pow(2,h),h++),delete s[l]}else for(o=a[l],r=0;r<h;r++)m=m<<1|1&o,g==e-1?(g=0,d.push(n(m)),m=0):g++,o>>=1;0==--p&&(p=Math.pow(2,h),h++),a[u]=f++,l=String(c)}if(""!==l){if(Object.prototype.hasOwnProperty.call(s,l)){if(l.charCodeAt(0)<256){for(r=0;r<h;r++)m<<=1,g==e-1?(g=0,d.push(n(m)),m=0):g++;for(o=l.charCodeAt(0),r=0;r<8;r++)m=m<<1|1&o,g==e-1?(g=0,d.push(n(m)),m=0):g++,o>>=1}else{for(o=1,r=0;r<h;r++)m=m<<1|o,g==e-1?(g=0,d.push(n(m)),m=0):g++,o=0;for(o=l.charCodeAt(0),r=0;r<16;r++)m=m<<1|1&o,g==e-1?(g=0,d.push(n(m)),m=0):g++,o>>=1}0==--p&&(p=Math.pow(2,h),h++),delete s[l]}else for(o=a[l],r=0;r<h;r++)m=m<<1|1&o,g==e-1?(g=0,d.push(n(m)),m=0):g++,o>>=1;0==--p&&(p=Math.pow(2,h),h++)}for(o=2,r=0;r<h;r++)m=m<<1|1&o,g==e-1?(g=0,d.push(n(m)),m=0):g++,o>>=1;for(;;){if(m<<=1,g==e-1){d.push(n(m));break}g++}return d.join("")},decompress:function(t){return null==t?"":""==t?null:i._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(e,n,r){var o,i,a,s,c,u,l,p=[],f=4,h=4,d=3,m="",g=[],y={val:r(0),position:n,index:1};for(o=0;o<3;o+=1)p[o]=o;for(a=0,c=Math.pow(2,2),u=1;u!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*u,u<<=1;switch(a){case 0:for(a=0,c=Math.pow(2,8),u=1;u!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*u,u<<=1;l=t(a);break;case 1:for(a=0,c=Math.pow(2,16),u=1;u!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*u,u<<=1;l=t(a);break;case 2:return""}for(p[3]=l,i=l,g.push(l);;){if(y.index>e)return"";for(a=0,c=Math.pow(2,d),u=1;u!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*u,u<<=1;switch(l=a){case 0:for(a=0,c=Math.pow(2,8),u=1;u!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*u,u<<=1;p[h++]=t(a),l=h-1,f--;break;case 1:for(a=0,c=Math.pow(2,16),u=1;u!=c;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*u,u<<=1;p[h++]=t(a),l=h-1,f--;break;case 2:return g.join("")}if(0==f&&(f=Math.pow(2,d),d++),p[l])m=p[l];else{if(l!==h)return null;m=i+i.charAt(0)}g.push(m),p[h++]=i+m.charAt(0),i=m,0==--f&&(f=Math.pow(2,d),d++)}}};return i}();void 0===(r=function(){return o}.call(e,n,e,t))||(t.exports=r)},function(t,e){var n=function(t,e){return this instanceof n?t instanceof n?t:("string"==typeof t&&(t=this.select(t,e)),t&&t.nodeName&&(t=[t]),void(this.nodes=this.slice(t))):new n(t,e)};n.prototype={get length(){return this.nodes.length}},n.prototype.nodes=[],n.prototype.addClass=function(){return this.eacharg(arguments,function(t,e){t.classList.add(e)})},n.prototype.adjacent=function(t,e,r){return"number"==typeof e&&(e=0===e?[]:new Array(e).join().split(",").map(Number.call,Number)),this.each(function(o,i){var a=document.createDocumentFragment();n(e||{}).map(function(e,r){var a="function"==typeof t?t.call(this,e,r,o,i):t;return"string"==typeof a?this.generate(a):n(a)}).each(function(t){this.isInPage(t)?a.appendChild(n(t).clone().first()):a.appendChild(t)}),r.call(this,o,a)})},n.prototype.after=function(t,e){return this.adjacent(t,e,function(t,e){t.parentNode.insertBefore(e,t.nextSibling)})},n.prototype.append=function(t,e){return this.adjacent(t,e,function(t,e){t.appendChild(e)})},n.prototype.args=function(t,e,n){return"function"==typeof t&&(t=t(e,n)),"string"!=typeof t&&(t=this.slice(t).map(this.str(e,n))),t.toString().split(/[\s,]+/).filter(function(t){return t.length})},n.prototype.array=function(t){t=t;var e=this;return this.nodes.reduce(function(r,o,i){var a;return t?((a=t.call(e,o,i))||(a=!1),"string"==typeof a&&(a=n(a)),a instanceof n&&(a=a.nodes)):a=o.innerHTML,r.concat(!1!==a?a:[])},[])},n.prototype.attr=function(t,e,n){return n=n?"data-":"",this.pairs(t,e,function(t,e){return t.getAttribute(n+e)},function(t,e,r){t.setAttribute(n+e,r)})},n.prototype.before=function(t,e){return this.adjacent(t,e,function(t,e){t.parentNode.insertBefore(e,t)})},n.prototype.children=function(t){return this.map(function(t){return this.slice(t.children)}).filter(t)},n.prototype.clone=function(){return this.map(function(t,e){var n=t.cloneNode(!0),r=this.getAll(n);return this.getAll(t).each(function(t,e){for(var n in this.mirror)this.mirror[n]&&this.mirror[n](t,r.nodes[e])}),n})},n.prototype.getAll=function(t){return n([t].concat(n("*",t).nodes))},n.prototype.mirror={},n.prototype.mirror.events=function(t,e){if(t._e)for(var r in t._e)t._e[r].forEach(function(t){n(e).on(r,t)})},n.prototype.mirror.select=function(t,e){n(t).is("select")&&(e.value=t.value)},n.prototype.mirror.textarea=function(t,e){n(t).is("textarea")&&(e.value=t.value)},n.prototype.closest=function(t){return this.map(function(e){do{if(n(e).is(t))return e}while((e=e.parentNode)&&e!==document)})},n.prototype.data=function(t,e){return this.attr(t,e,!0)},n.prototype.each=function(t){return this.nodes.forEach(t.bind(this)),this},n.prototype.eacharg=function(t,e){return this.each(function(n,r){this.args(t,n,r).forEach(function(t){e.call(this,n,t)},this)})},n.prototype.empty=function(){return this.each(function(t){for(;t.firstChild;)t.removeChild(t.firstChild)})},n.prototype.filter=function(t){var e=function(e){return e.matches=e.matches||e.msMatchesSelector||e.webkitMatchesSelector,e.matches(t||"*")};return"function"==typeof t&&(e=t),t instanceof n&&(e=function(e){return-1!==t.nodes.indexOf(e)}),n(this.nodes.filter(e))},n.prototype.find=function(t){return this.map(function(e){return n(t||"*",e)})},n.prototype.first=function(){return this.nodes[0]||!1},n.prototype.generate=function(t){return/^\s*<tr[> ]/.test(t)?n(document.createElement("table")).html(t).children().children().nodes:/^\s*<t(h|d)[> ]/.test(t)?n(document.createElement("table")).html(t).children().children().children().nodes:/^\s*</.test(t)?n(document.createElement("div")).html(t).children().nodes:document.createTextNode(t)},n.prototype.handle=function(){var t=this.slice(arguments).map(function(t){return"function"==typeof t?function(e){e.preventDefault(),t.apply(this,arguments)}:t},this);return this.on.apply(this,t)},n.prototype.hasClass=function(){return this.is("."+this.args(arguments).join("."))},n.prototype.html=function(t){return void 0===t?this.first().innerHTML||"":this.each(function(e){e.innerHTML=t})},n.prototype.is=function(t){return 0<this.filter(t).length},n.prototype.isInPage=function(t){return t!==document.body&&document.body.contains(t)},n.prototype.last=function(){return this.nodes[this.length-1]||!1},n.prototype.map=function(t){return t?n(this.array(t)).unique():this},n.prototype.not=function(t){return this.filter(function(e){return!n(e).is(t||!0)})},n.prototype.off=function(t){return this.eacharg(t,function(t,e){n(t._e?t._e[e]:[]).each(function(n){t.removeEventListener(e,n)})})},n.prototype.on=function(t,e,r){if("string"==typeof e){var o=e;e=function(t){var e=arguments;n(t.currentTarget).find(o).each(function(n){if(n===t.target||n.contains(t.target)){try{Object.defineProperty(t,"currentTarget",{get:function(){return n}})}catch(n){}r.apply(n,e)}})}}var i=function(t){return e.apply(this,[t].concat(t.detail||[]))};return this.eacharg(t,function(t,e){t.addEventListener(e,i),t._e=t._e||{},t._e[e]=t._e[e]||[],t._e[e].push(i)})},n.prototype.pairs=function(t,e,n,r){if(void 0!==e){var o=t;(t={})[o]=e}return"object"==typeof t?this.each(function(e){for(var n in t)r(e,n,t[n])}):this.length?n(this.first(),t):""},n.prototype.param=function(t){return Object.keys(t).map(function(e){return this.uri(e)+"="+this.uri(t[e])}.bind(this)).join("&")},n.prototype.parent=function(t){return this.map(function(t){return t.parentNode}).filter(t)},n.prototype.prepend=function(t,e){return this.adjacent(t,e,function(t,e){t.insertBefore(e,t.firstChild)})},n.prototype.remove=function(){return this.each(function(t){t.parentNode&&t.parentNode.removeChild(t)})},n.prototype.removeClass=function(){return this.eacharg(arguments,function(t,e){t.classList.remove(e)})},n.prototype.replace=function(t,e){var r=[];return this.adjacent(t,e,function(t,e){r=r.concat(this.slice(e.children)),t.parentNode.replaceChild(e,t)}),n(r)},n.prototype.scroll=function(){return this.first().scrollIntoView({behavior:"smooth"}),this},n.prototype.select=function(t,e){return t=t.replace(/^\s*/,"").replace(/\s*$/,""),/^</.test(t)?n().generate(t):(e||document).querySelectorAll(t)},n.prototype.serialize=function(){var t=this;return this.slice(this.first().elements).reduce(function(e,r){return!r.name||r.disabled||"file"===r.type?e:/(checkbox|radio)/.test(r.type)&&!r.checked?e:"select-multiple"===r.type?(n(r.options).each(function(n){n.selected&&(e+="&"+t.uri(r.name)+"="+t.uri(n.value))}),e):e+"&"+t.uri(r.name)+"="+t.uri(r.value)},"").slice(1)},n.prototype.siblings=function(t){return this.parent().children(t).not(this)},n.prototype.size=function(){return this.first().getBoundingClientRect()},n.prototype.slice=function(t){return t&&0!==t.length&&"string"!=typeof t&&"[object Function]"!==t.toString()?t.length?[].slice.call(t.nodes||t):[t]:[]},n.prototype.str=function(t,e){return function(n){return"function"==typeof n?n.call(this,t,e):n.toString()}},n.prototype.text=function(t){return void 0===t?this.first().textContent||"":this.each(function(e){e.textContent=t})},n.prototype.toggleClass=function(t,e){return!!e===e?this[e?"addClass":"removeClass"](t):this.eacharg(t,function(t,e){t.classList.toggle(e)})},n.prototype.trigger=function(t){var e=this.slice(arguments).slice(1);return this.eacharg(t,function(t,n){var r,o={bubbles:!0,cancelable:!0,detail:e};try{r=new window.CustomEvent(n,o)}catch(t){(r=document.createEvent("CustomEvent")).initCustomEvent(n,!0,!0,e)}t.dispatchEvent(r)})},n.prototype.unique=function(){return n(this.nodes.reduce(function(t,e){return null!=e&&!1!==e&&-1===t.indexOf(e)?t.concat(e):t},[]))},n.prototype.uri=function(t){return encodeURIComponent(t).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")},n.prototype.wrap=function(t){return this.map(function(e){return n(t).each(function(t){(function(t){for(;t.firstElementChild;)t=t.firstElementChild;return n(t)})(t).append(e.cloneNode(!0)),e.parentNode.replaceChild(t,e)})})},"object"==typeof t&&t.exports&&(t.exports=n,t.exports.u=n)},function(t,e,n){"use strict";const r=n(6),o=n(4);t.exports=class{constructor(t,e){this.railroads=r.feature(t,t.objects.railroads),this.stations=r.feature(e,e.objects.stations),this.railroadHashes=new Map,this.stationHashes=new Map,this.mapLineStation=new Map;for(let t=0;t<this.railroads.features.length;t++){var n=this.railroads.features[t].properties;const e=n.company,r=n.lineName,i=o.hash32(`${e}ÿ${r}`);this.railroadHashes.has(i)||this.railroadHashes.set(i,{indexes:[],company:e,line:r}),this.railroadHashes.get(i).indexes.push(t)}for(let t=0;t<this.stations.features.length;t++){var i=this.stations.features[t].properties;const e=i.company,n=i.lineName,r=i.groupId,a=i.stationName,s=o.hash32(r);this.stationHashes.has(s)||this.stationHashes.set(s,{index:t,id:r,name:a,company:e,line:n});const c=o.hash32(`${e}ÿ${n}`);this.mapLineStation.has(c)||this.mapLineStation.set(c,[]),this.mapLineStation.get(c).push({index:t,hash:s,id:r,name:a})}}getRailroadFeatures(t){const e=this.railroadHashes.get(t);return!!e&&e.indexes.map(t=>this.railroads.features[t])}searchRailroads(t){const e=[],n={};return this.railroads.features.filter(e=>e.properties.lineName.includes(t)||e.properties.company.includes(t)).forEach(t=>{const r=`${t.properties.company}ÿ${t.properties.lineName}`,i=o.hash32(r);i in n||(n[i]=!0,e.push({type:"line",hash:i,company:t.properties.company,line:t.properties.lineName,features:this.getRailroadFeatures(i)}))}),e}getStationsFromLine(t){const e=this.mapLineStation.get(t);return!!e&&(e.sort((t,e)=>t.id.localeCompare(e.id)),e)}getStationFeature(t){const e=this.stationHashes.get(t);return!!e&&this.stations.features[e.index]}}},function(t,e,n){"use strict";t.exports={geo:{length:function(t){if(t.length<2)return 0;let e=0;for(let n=1;n<t.length;n++)e+=distance(t[n-1][1],t[n-1][0],t[n][1],t[n][0]);return e},distance:function(t,e,n,r){const o=(n-t)*Math.PI/180,i=(r-e)*Math.PI/180,a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371e3}},hash32:function(t){let e=5381,n=t.length;for(;n;)e=33*e^t.charCodeAt(--n);return e>>>0}}},function(t,e,n){"use strict";t.exports.VERSION_RAILROAD=1,t.exports.VERSION_STATION=4},function(t,e,n){"use strict";n.r(e);var r=function(t){return t},o=function(t){if(null==t)return r;var e,n,o=t.scale[0],i=t.scale[1],a=t.translate[0],s=t.translate[1];return function(t,r){r||(e=n=0);var c=2,u=t.length,l=new Array(u);for(l[0]=(e+=t[0])*o+a,l[1]=(n+=t[1])*i+s;c<u;)l[c]=t[c],++c;return l}},i=function(t){var e,n=o(t.transform),r=1/0,i=r,a=-r,s=-r;function c(t){(t=n(t))[0]<r&&(r=t[0]),t[0]>a&&(a=t[0]),t[1]<i&&(i=t[1]),t[1]>s&&(s=t[1])}function u(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(u);break;case"Point":c(t.coordinates);break;case"MultiPoint":t.coordinates.forEach(c)}}for(e in t.arcs.forEach(function(t){for(var e,o=-1,c=t.length;++o<c;)(e=n(t[o],o))[0]<r&&(r=e[0]),e[0]>a&&(a=e[0]),e[1]<i&&(i=e[1]),e[1]>s&&(s=e[1])}),t.objects)u(t.objects[e]);return[r,i,a,s]},a=function(t,e){for(var n,r=t.length,o=r-e;o<--r;)n=t[o],t[o++]=t[r],t[r]=n},s=function(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return c(t,e)})}:c(t,e)};function c(t,e){var n=e.id,r=e.bbox,o=null==e.properties?{}:e.properties,i=u(t,e);return null==n&&null==r?{type:"Feature",properties:o,geometry:i}:null==r?{type:"Feature",id:n,properties:o,geometry:i}:{type:"Feature",id:n,bbox:r,properties:o,geometry:i}}function u(t,e){var n=o(t.transform),r=t.arcs;function i(t,e){e.length&&e.pop();for(var o=r[t<0?~t:t],i=0,s=o.length;i<s;++i)e.push(n(o[i],i));t<0&&a(e,s)}function s(t){return n(t)}function c(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0]),e}function u(t){for(var e=c(t);e.length<4;)e.push(e[0]);return e}function l(t){return t.map(u)}return function t(e){var n,r=e.type;switch(r){case"GeometryCollection":return{type:r,geometries:e.geometries.map(t)};case"Point":n=s(e.coordinates);break;case"MultiPoint":n=e.coordinates.map(s);break;case"LineString":n=c(e.arcs);break;case"MultiLineString":n=e.arcs.map(c);break;case"Polygon":n=l(e.arcs);break;case"MultiPolygon":n=e.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(e)}var l=function(t,e){var n={},r={},o={},i=[],a=-1;function s(t,e){for(var r in t){var o=t[r];delete e[o.start],delete o.start,delete o.end,o.forEach(function(t){n[t<0?~t:t]=1}),i.push(o)}}return e.forEach(function(n,r){var o,i=t.arcs[n<0?~n:n];i.length<3&&!i[1][0]&&!i[1][1]&&(o=e[++a],e[a]=n,e[r]=o)}),e.forEach(function(e){var n,i,a=function(e){var n,r=t.arcs[e<0?~e:e],o=r[0];t.transform?(n=[0,0],r.forEach(function(t){n[0]+=t[0],n[1]+=t[1]})):n=r[r.length-1];return e<0?[n,o]:[o,n]}(e),s=a[0],c=a[1];if(n=o[s])if(delete o[n.end],n.push(e),n.end=c,i=r[c]){delete r[i.start];var u=i===n?n:n.concat(i);r[u.start=n.start]=o[u.end=i.end]=u}else r[n.start]=o[n.end]=n;else if(n=r[c])if(delete r[n.start],n.unshift(e),n.start=s,i=o[s]){delete o[i.end];var l=i===n?n:i.concat(n);r[l.start=i.start]=o[l.end=n.end]=l}else r[n.start]=o[n.end]=n;else r[(n=[e]).start=s]=o[n.end=c]=n}),s(o,r),s(r,o),e.forEach(function(t){n[t<0?~t:t]||i.push([t])}),i},p=function(t){return u(t,f.apply(this,arguments))};function f(t,e,n){var r,o,i;if(arguments.length>1)r=function(t,e,n){var r,o=[],i=[];function a(t){var e=t<0?~t:t;(i[e]||(i[e]=[])).push({i:t,g:r})}function s(t){t.forEach(a)}function c(t){t.forEach(s)}return function t(e){switch(r=e,e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"LineString":s(e.arcs);break;case"MultiLineString":case"Polygon":c(e.arcs);break;case"MultiPolygon":!function(t){t.forEach(c)}(e.arcs)}}(e),i.forEach(null==n?function(t){o.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&o.push(t[0].i)}),o}(0,e,n);else for(o=0,r=new Array(i=t.arcs.length);o<i;++o)r[o]=o;return{type:"MultiLineString",arcs:l(t,r)}}var h=function(t){return u(t,d.apply(this,arguments))};function d(t,e){var n={},r=[],o=[];function i(t){t.forEach(function(e){e.forEach(function(e){(n[e=e<0?~e:e]||(n[e]=[])).push(t)})}),r.push(t)}function a(e){return function(t){for(var e,n=-1,r=t.length,o=t[r-1],i=0;++n<r;)e=o,o=t[n],i+=e[0]*o[1]-e[1]*o[0];return Math.abs(i)}(u(t,{type:"Polygon",arcs:[e]}).coordinates[0])}return e.forEach(function t(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(t);break;case"Polygon":i(e.arcs);break;case"MultiPolygon":e.arcs.forEach(i)}}),r.forEach(function(t){if(!t._){var e=[],r=[t];for(t._=1,o.push(e);t=r.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){n[t<0?~t:t].forEach(function(t){t._||(t._=1,r.push(t))})})})}}),r.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:o.map(function(e){var r,o=[];if(e.forEach(function(t){t.forEach(function(t){t.forEach(function(t){n[t<0?~t:t].length<2&&o.push(t)})})}),(r=(o=l(t,o)).length)>1)for(var i,s,c=1,u=a(o[0]);c<r;++c)(i=a(o[c]))>u&&(s=o[0],o[0]=o[c],o[c]=s,u=i);return o})}}var m=function(t,e){for(var n=0,r=t.length;n<r;){var o=n+r>>>1;t[o]<e?n=o+1:r=o}return n},g=function(t){var e={},n=t.map(function(){return[]});function r(t,n){t.forEach(function(t){t<0&&(t=~t);var r=e[t];r?r.push(n):e[t]=[n]})}function o(t,e){t.forEach(function(t){r(t,e)})}var i={LineString:r,MultiLineString:o,Polygon:o,MultiPolygon:function(t,e){t.forEach(function(t){o(t,e)})}};for(var a in t.forEach(function t(e,n){"GeometryCollection"===e.type?e.geometries.forEach(function(e){t(e,n)}):e.type in i&&i[e.type](e.arcs,n)}),e)for(var s=e[a],c=s.length,u=0;u<c;++u)for(var l=u+1;l<c;++l){var p,f=s[u],h=s[l];(p=n[f])[a=m(p,h)]!==h&&p.splice(a,0,h),(p=n[h])[a=m(p,f)]!==f&&p.splice(a,0,f)}return n},y=function(t){if(null==t)return r;var e,n,o=t.scale[0],i=t.scale[1],a=t.translate[0],s=t.translate[1];return function(t,r){r||(e=n=0);var c=2,u=t.length,l=new Array(u),p=Math.round((t[0]-a)/o),f=Math.round((t[1]-s)/i);for(l[0]=p-e,e=p,l[1]=f-n,n=f;c<u;)l[c]=t[c],++c;return l}},v=function(t,e){if(t.transform)throw new Error("already quantized");if(e&&e.scale)c=t.bbox;else{if(!((n=Math.floor(e))>=2))throw new Error("n must be ≥2");var n,r=(c=t.bbox||i(t))[0],o=c[1],a=c[2],s=c[3];e={scale:[a-r?(a-r)/(n-1):1,s-o?(s-o)/(n-1):1],translate:[r,o]}}var c,u,l=y(e),p=t.objects,f={};function h(t){return l(t)}function d(t){var e;switch(t.type){case"GeometryCollection":e={type:"GeometryCollection",geometries:t.geometries.map(d)};break;case"Point":e={type:"Point",coordinates:h(t.coordinates)};break;case"MultiPoint":e={type:"MultiPoint",coordinates:t.coordinates.map(h)};break;default:return t}return null!=t.id&&(e.id=t.id),null!=t.bbox&&(e.bbox=t.bbox),null!=t.properties&&(e.properties=t.properties),e}for(u in p)f[u]=d(p[u]);return{type:"Topology",bbox:c,transform:e,objects:f,arcs:t.arcs.map(function(t){var e,n=0,r=1,o=t.length,i=new Array(o);for(i[0]=l(t[0],0);++n<o;)((e=l(t[n],n))[0]||e[1])&&(i[r++]=e);return 1===r&&(i[r++]=[0,0]),i.length=r,i})}};n.d(e,"bbox",function(){return i}),n.d(e,"feature",function(){return s}),n.d(e,"mesh",function(){return p}),n.d(e,"meshArcs",function(){return f}),n.d(e,"merge",function(){return h}),n.d(e,"mergeArcs",function(){return d}),n.d(e,"neighbors",function(){return g}),n.d(e,"quantize",function(){return v}),n.d(e,"transform",function(){return o}),n.d(e,"untransform",function(){return y})}]);